<Activity mc:Ignorable="sap sap2010" x:Class="draft_workflow_email" VisualBasic.Settings="{x:Null}" sap2010:WorkflowViewState.IdRef="draft_workflow_email_1" xmlns="http://schemas.microsoft.com/netfx/2009/xaml/activities" xmlns:av="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:isactr="http://schemas.uipath.com/workflow/integration-service-activities/isactr" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:njl="clr-namespace:Newtonsoft.Json.Linq;assembly=Newtonsoft.Json" xmlns:s="clr-namespace:System;assembly=System.Private.CoreLib" xmlns:sap="http://schemas.microsoft.com/netfx/2009/xaml/activities/presentation" xmlns:sap2010="http://schemas.microsoft.com/netfx/2010/xaml/activities/presentation" xmlns:scg="clr-namespace:System.Collections.Generic;assembly=System.Private.CoreLib" xmlns:sco="clr-namespace:System.Collections.ObjectModel;assembly=System.Private.CoreLib" xmlns:sd="clr-namespace:System.Data;assembly=System.Data.Common" xmlns:snm="clr-namespace:System.Net.Mail;assembly=System.Net.Mail" xmlns:ss="clr-namespace:System.Security;assembly=System.Private.CoreLib" xmlns:uga="clr-namespace:UiPath.GSuite.Activities;assembly=UiPath.GSuite.Activities" xmlns:ugage="clr-namespace:UiPath.GSuite.Activities.Gmail.Enums;assembly=UiPath.GSuite.Activities" xmlns:ui="http://schemas.uipath.com/workflow/activities" xmlns:uiascb="clr-namespace:UiPath.IntegrationService.Activities.SWEntities.C2AA0D6B748_v2_sub_generateChatCompletion_Create.Bundle;assembly=C2AA0D6B748_v2_sub_g.j03HYHLeYN1VRj8OnAGJ92" xmlns:umae="clr-namespace:UiPath.Mail.Activities.Enums;assembly=UiPath.Mail.Activities" xmlns:uoic="clr-namespace:UiPath.OpenAI.IntegrationService.Client;assembly=UiPath.OpenAI.IntegrationService" xmlns:upr="clr-namespace:UiPath.Platform.ResourceHandling;assembly=UiPath.Platform" xmlns:usau="clr-namespace:UiPath.Shared.Activities.Utils;assembly=UiPath.Mail.Activities" xmlns:usau1="clr-namespace:UiPath.Shared.Activities.Utils;assembly=UiPath.GSuite.Activities" xmlns:uwahm="clr-namespace:UiPath.Web.Activities.Http.Models;assembly=UiPath.Web.Activities" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <TextExpression.NamespacesForImplementation>
    <sco:Collection x:TypeArguments="x:String">
      <x:String>System.Activities</x:String>
      <x:String>System.Activities.Statements</x:String>
      <x:String>System.Activities.Expressions</x:String>
      <x:String>System.Activities.Validation</x:String>
      <x:String>System.Activities.XamlIntegration</x:String>
      <x:String>Microsoft.VisualBasic</x:String>
      <x:String>Microsoft.VisualBasic.Activities</x:String>
      <x:String>System</x:String>
      <x:String>System.Collections</x:String>
      <x:String>System.Collections.Generic</x:String>
      <x:String>System.Collections.ObjectModel</x:String>
      <x:String>System.Data</x:String>
      <x:String>System.Diagnostics</x:String>
      <x:String>System.Drawing</x:String>
      <x:String>System.IO</x:String>
      <x:String>System.Linq</x:String>
      <x:String>System.Net.Mail</x:String>
      <x:String>System.Xml</x:String>
      <x:String>System.Xml.Linq</x:String>
      <x:String>System.Windows.Markup</x:String>
      <x:String>UiPath.Core</x:String>
      <x:String>UiPath.Core.Activities</x:String>
      <x:String>GlobalVariablesNamespace</x:String>
      <x:String>GlobalConstantsNamespace</x:String>
      <x:String>UiPath.Excel</x:String>
      <x:String>UiPath.Excel.Activities.Business</x:String>
      <x:String>UiPath.Platform.ResourceHandling</x:String>
      <x:String>UiPath.Excel.Activities</x:String>
      <x:String>UiPath.Mail</x:String>
      <x:String>UiPath.Mail.Activities.Enums</x:String>
      <x:String>UiPath.Shared.Activities.Utils</x:String>
      <x:String>UiPath.Mail.IMAP.Activities</x:String>
      <x:String>UiPath.Shared.Activities</x:String>
      <x:String>UiPath.Mail.Activities</x:String>
      <x:String>Newtonsoft.Json.Linq</x:String>
      <x:String>Newtonsoft.Json</x:String>
      <x:String>System.Dynamic</x:String>
      <x:String>System.Collections.Specialized</x:String>
      <x:String>System.ComponentModel</x:String>
      <x:String>System.Runtime.Serialization</x:String>
      <x:String>System.Xml.Serialization</x:String>
      <x:String>UiPath.Web.Activities.Http.Models</x:String>
      <x:String>UiPath.OpenAI.IntegrationService.Client</x:String>
      <x:String>UiPath.DataTableUtilities</x:String>
      <x:String>System.Reflection</x:String>
      <x:String>UiPath.IntegrationService.Activities.Runtime.Models.FilterBuilder</x:String>
      <x:String>UiPath.IntegrationService.Activities.Runtime.Models</x:String>
      <x:String>UiPath.IntegrationService.Activities.Runtime.Helpers.TypeDetailsCustomization</x:String>
      <x:String>UiPath.Web.Activities.JSON.Models</x:String>
      <x:String>System.Activities.Runtime.Collections</x:String>
      <x:String>UiPath.IntegrationService.Activities.Runtime.Activities</x:String>
      <x:String>UiPath.Platform.Activities</x:String>
      <x:String>UiPath.Web.Activities</x:String>
      <x:String>System.Text.RegularExpressions</x:String>
      <x:String>System.Linq.Expressions</x:String>
      <x:String>UiPath.GSuite.Activities.Gmail.Enums</x:String>
      <x:String>UiPath.GSuite.Activities</x:String>
      <x:String>UiPath.Shared.Activities.ConnectionService.Contracts</x:String>
      <x:String>System.Numerics</x:String>
      <x:String>System.Globalization</x:String>
    </sco:Collection>
  </TextExpression.NamespacesForImplementation>
  <TextExpression.ReferencesForImplementation>
    <sco:Collection x:TypeArguments="AssemblyReference">
      <AssemblyReference>Microsoft.VisualBasic</AssemblyReference>
      <AssemblyReference>mscorlib</AssemblyReference>
      <AssemblyReference>System</AssemblyReference>
      <AssemblyReference>System.Activities</AssemblyReference>
      <AssemblyReference>System.ComponentModel.TypeConverter</AssemblyReference>
      <AssemblyReference>System.Core</AssemblyReference>
      <AssemblyReference>System.Data</AssemblyReference>
      <AssemblyReference>System.Data.Common</AssemblyReference>
      <AssemblyReference>System.Data.DataSetExtensions</AssemblyReference>
      <AssemblyReference>System.Drawing</AssemblyReference>
      <AssemblyReference>System.Drawing.Common</AssemblyReference>
      <AssemblyReference>System.Drawing.Primitives</AssemblyReference>
      <AssemblyReference>System.Linq</AssemblyReference>
      <AssemblyReference>System.Net.Mail</AssemblyReference>
      <AssemblyReference>System.ObjectModel</AssemblyReference>
      <AssemblyReference>System.Private.CoreLib</AssemblyReference>
      <AssemblyReference>System.Xaml</AssemblyReference>
      <AssemblyReference>System.Xml</AssemblyReference>
      <AssemblyReference>System.Xml.Linq</AssemblyReference>
      <AssemblyReference>UiPath.System.Activities</AssemblyReference>
      <AssemblyReference>UiPath.UiAutomation.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Studio.Constants</AssemblyReference>
      <AssemblyReference>UiPath.Excel.Activities.Design</AssemblyReference>
      <AssemblyReference>UiPath.Excel.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Excel</AssemblyReference>
      <AssemblyReference>System.Security.Permissions</AssemblyReference>
      <AssemblyReference>System.Runtime.InteropServices</AssemblyReference>
      <AssemblyReference>System.Reflection.DispatchProxy</AssemblyReference>
      <AssemblyReference>System.Reflection.TypeExtensions</AssemblyReference>
      <AssemblyReference>System.Reflection.Metadata</AssemblyReference>
      <AssemblyReference>UiPath.Activities.Contracts</AssemblyReference>
      <AssemblyReference>System.ComponentModel.EventBasedAsync</AssemblyReference>
      <AssemblyReference>PresentationFramework</AssemblyReference>
      <AssemblyReference>WindowsBase</AssemblyReference>
      <AssemblyReference>System.ComponentModel</AssemblyReference>
      <AssemblyReference>System.ComponentModel.Primitives</AssemblyReference>
      <AssemblyReference>System.Private.ServiceModel</AssemblyReference>
      <AssemblyReference>System.Private.DataContractSerialization</AssemblyReference>
      <AssemblyReference>System.Runtime.Serialization.Formatters</AssemblyReference>
      <AssemblyReference>System.Runtime.Serialization.Primitives</AssemblyReference>
      <AssemblyReference>System.Private.Xml</AssemblyReference>
      <AssemblyReference>UiPath.Platform</AssemblyReference>
      <AssemblyReference>UiPath.Mail</AssemblyReference>
      <AssemblyReference>UiPath.Mail.Activities</AssemblyReference>
      <AssemblyReference>UiPath.GSuite.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Testing.Activities</AssemblyReference>
      <AssemblyReference>UiPath.DocumentUnderstanding.ML.Activities</AssemblyReference>
      <AssemblyReference>InternalLabs.OpenAI.DallE.Activities</AssemblyReference>
      <AssemblyReference>UiPath.IntelligentOCR.Activities</AssemblyReference>
      <AssemblyReference>UiPath.OCR.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Web.Activities</AssemblyReference>
      <AssemblyReference>UiPath.UIAutomationCore</AssemblyReference>
      <AssemblyReference>UiPath.Mail.Activities.Design</AssemblyReference>
      <AssemblyReference>Newtonsoft.Json</AssemblyReference>
      <AssemblyReference>System.Linq.Expressions</AssemblyReference>
      <AssemblyReference>System.Collections.Specialized</AssemblyReference>
      <AssemblyReference>System.Collections.NonGeneric</AssemblyReference>
      <AssemblyReference>UiPath.OpenAI.IntegrationService</AssemblyReference>
      <AssemblyReference>UiPath.IntegrationService.Activities.Runtime</AssemblyReference>
      <AssemblyReference>System.Text.RegularExpressions</AssemblyReference>
      <AssemblyReference>System.Memory.Data</AssemblyReference>
      <AssemblyReference>System.Console</AssemblyReference>
      <AssemblyReference>System.Configuration.ConfigurationManager</AssemblyReference>
      <AssemblyReference>System.Memory</AssemblyReference>
      <AssemblyReference>System.Private.Uri</AssemblyReference>
      <AssemblyReference>System.Linq.Async</AssemblyReference>
      <AssemblyReference>NPOI.Core</AssemblyReference>
      <AssemblyReference>System.Collections</AssemblyReference>
      <AssemblyReference>System.CodeDom</AssemblyReference>
      <AssemblyReference>Microsoft.VisualBasic.Forms</AssemblyReference>
      <AssemblyReference>Microsoft.VisualBasic.Core</AssemblyReference>
      <AssemblyReference>System.Data.SqlClient</AssemblyReference>
      <AssemblyReference>UiPath.Workflow</AssemblyReference>
      <AssemblyReference>System.Runtime.Numerics</AssemblyReference>
    </sco:Collection>
  </TextExpression.ReferencesForImplementation>
  <Flowchart DisplayName="draft_workflow_email" sap:VirtualizedContainerService.HintSize="676,394.32333333333327" sap2010:WorkflowViewState.IdRef="Flowchart_1">
    <Flowchart.Variables>
      <Variable x:TypeArguments="x:String" Name="nameSheet" />
      <Variable x:TypeArguments="sd:DataTable" Name="dt_Email" />
      <Variable x:TypeArguments="x:String" Name="creUsername" />
      <Variable x:TypeArguments="ss:SecureString" Name="crePassword" />
      <Variable x:TypeArguments="scg:List(snm:MailMessage)" Name="email_list" />
      <Variable x:TypeArguments="x:String" Name="password" />
      <Variable x:TypeArguments="x:Int32" Name="rowNumb" />
      <Variable x:TypeArguments="sd:DataTable" Name="dtData" />
      <Variable x:TypeArguments="sd:DataTable" Name="dt_Department" />
      <Variable x:TypeArguments="x:String" Name="sheetName" />
    </Flowchart.Variables>
    <sap:WorkflowViewStateService.ViewState>
      <scg:Dictionary x:TypeArguments="x:String, x:Object">
        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
        <av:Size x:Key="ShapeSize">50,50</av:Size>
        <av:Point x:Key="ShapeLocation">555,45</av:Point>
        <av:PointCollection x:Key="ConnectorLocation">580.1076923076923,95.21538461538461 580.1076923076923,125.21538461538461 580.0153846153846,125.21538461538461 580.0153846153846,165</av:PointCollection>
      </scg:Dictionary>
    </sap:WorkflowViewStateService.ViewState>
    <Flowchart.StartNode>
      <x:Reference>__ReferenceID13</x:Reference>
    </Flowchart.StartNode>
    <FlowStep x:Name="__ReferenceID2" sap2010:WorkflowViewState.IdRef="FlowStep_2">
      <sap:WorkflowViewStateService.ViewState>
        <scg:Dictionary x:TypeArguments="x:String, x:Object">
          <av:Point x:Key="ShapeLocation">525,265</av:Point>
          <av:Size x:Key="ShapeSize">110,70</av:Size>
          <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,335.15384615384613 580.0153846153846,375</av:PointCollection>
        </scg:Dictionary>
      </sap:WorkflowViewStateService.ViewState>
      <Sequence DisplayName="Read Email &amp; Load Data" sap:VirtualizedContainerService.HintSize="110,70" sap2010:WorkflowViewState.IdRef="Sequence_1">
        <sap:WorkflowViewStateService.ViewState>
          <scg:Dictionary x:TypeArguments="x:String, x:Object">
            <x:Boolean x:Key="IsExpanded">True</x:Boolean>
          </scg:Dictionary>
        </sap:WorkflowViewStateService.ViewState>
        <ui:GetRobotCredential TimeoutMS="{x:Null}" AssetName="Gmail_IMAP_Cred" CacheStrategy="None" DisplayName="Get Credential" FolderPath="Email Automation RPA" sap:VirtualizedContainerService.HintSize="513.3333333333334,176.66666666666666" sap2010:WorkflowViewState.IdRef="GetRobotCredential_2" Password="[crePassword]" Username="[creUsername]" />
        <ui:GetPassword DisplayName="Get Password" sap:VirtualizedContainerService.HintSize="513.3333333333334,57.333333333333336" sap2010:WorkflowViewState.IdRef="GetPassword_2" ProtectedPassword="AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAMNr8A5/RukabCgNFBXCquwAAAAACAAAAAAAQZgAAAAEAACAAAAB8qHsOiaz8kOMJPdMQa9yZnnN5OQkcZJEtR6+rCqT+JAAAAAAOgAAAAAIAACAAAABthASz62yOF5POnyY5g5zru7y3dwzmMxYvYpUw9zaF4iAAAABW8nc/8eo1CuIu6QGoUFxWu8KgjPbAqjqaif7YmEkVY0AAAACn723mxFSa67AsJt1UpcJXggt1hCgBI1E1rBIaAq8GGzX54nbfaVbngomyu1CmNnB4A6TtGOJRwzvRaaCXMz7M" Result="[password]" />
        <ui:BuildDataTable DataTable="[dt_Email]" DisplayName="Build Data Table" sap:VirtualizedContainerService.HintSize="513.3333333333334,92" sap2010:WorkflowViewState.IdRef="BuildDataTable_2" TableInfo="&lt;NewDataSet&gt;&#xA;  &lt;xs:schema id=&quot;NewDataSet&quot; xmlns=&quot;&quot; xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:msdata=&quot;urn:schemas-microsoft-com:xml-msdata&quot;&gt;&#xA;    &lt;xs:element name=&quot;NewDataSet&quot; msdata:IsDataSet=&quot;true&quot; msdata:MainDataTable=&quot;TableName&quot; msdata:UseCurrentLocale=&quot;true&quot;&gt;&#xA;      &lt;xs:complexType&gt;&#xA;        &lt;xs:choice minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot;&gt;&#xA;          &lt;xs:element name=&quot;TableName&quot;&gt;&#xA;            &lt;xs:complexType&gt;&#xA;              &lt;xs:sequence&gt;&#xA;                &lt;xs:element name=&quot;No&quot; msdata:Caption=&quot;&quot; type=&quot;xs:int&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Sender_Name&quot; msdata:Caption=&quot;&quot; minOccurs=&quot;0&quot;&gt;&#xA;                  &lt;xs:simpleType&gt;&#xA;                    &lt;xs:restriction base=&quot;xs:string&quot;&gt;&#xA;                      &lt;xs:maxLength value=&quot;100&quot; /&gt;&#xA;                    &lt;/xs:restriction&gt;&#xA;                  &lt;/xs:simpleType&gt;&#xA;                &lt;/xs:element&gt;&#xA;                &lt;xs:element name=&quot;Sender_Email&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Received_Time&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Subject&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Body_Email&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Sentiment&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Category&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Assign_x0020_to&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Time_Assigned&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Department&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Keeptrack&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;                &lt;xs:element name=&quot;Deadline&quot; msdata:Caption=&quot;&quot; type=&quot;xs:string&quot; minOccurs=&quot;0&quot; /&gt;&#xA;              &lt;/xs:sequence&gt;&#xA;            &lt;/xs:complexType&gt;&#xA;          &lt;/xs:element&gt;&#xA;        &lt;/xs:choice&gt;&#xA;      &lt;/xs:complexType&gt;&#xA;    &lt;/xs:element&gt;&#xA;  &lt;/xs:schema&gt;&#xA;&lt;/NewDataSet&gt;">
          <sap:WorkflowViewStateService.ViewState>
            <scg:Dictionary x:TypeArguments="x:String, x:Object">
              <x:Boolean x:Key="IsExpanded">True</x:Boolean>
            </scg:Dictionary>
          </sap:WorkflowViewStateService.ViewState>
        </ui:BuildDataTable>
        <ui:WriteRange StartingCell="{x:Null}" WorkbookPathResource="{x:Null}" DataTable="[dt_Email]" DisplayName="Write Range Workbook" sap:VirtualizedContainerService.HintSize="513.3333333333334,148" sap2010:WorkflowViewState.IdRef="WriteRange_1" SheetName="[nameSheet]" WorkbookPath="EmailAssignment/AssignedEmail.xlsx" />
        <ui:GetIMAPMailMessages ClientName="{x:Null}" ClientVersion="{x:Null}" SecurePassword="{x:Null}" TimeoutMS="{x:Null}" Top="{x:Null}" ConnectionMode="LegacyConfiguration" DeleteMessages="False" DisplayName="Get IMAP Mail Messages" Email="[creUsername]" EnableSSL="True" FilterExpression="[&quot;SINCE &quot; + Now.ToString(&quot;dd-MMM-yyyy&quot;)]" FilterExpressionCharacterSet="US-ASCII" sap:VirtualizedContainerService.HintSize="513.3333333333334,176.66666666666666" sap2010:WorkflowViewState.IdRef="GetIMAPMailMessages_1" IgnoreCRL="False" MailFolder="inbox" MarkAsRead="False" Messages="[email_list]" OnlyUnreadMessages="False" OrderByDate="NewestFirst" Password="[password]" Port="993" SecureConnection="Auto" Server="imap.gmail.com" UseISConnection="False" UseOAuth="True">
          <ui:GetIMAPMailMessages.ConnectionDetailsBackupSlot>
            <usau:BackupSlot x:TypeArguments="umae:ConnectionDetails" StoredValue="LegacyConfiguration">
              <usau:BackupSlot.BackupValues>
                <scg:Dictionary x:TypeArguments="umae:ConnectionDetails, scg:List(x:Object)" />
              </usau:BackupSlot.BackupValues>
            </usau:BackupSlot>
          </ui:GetIMAPMailMessages.ConnectionDetailsBackupSlot>
        </ui:GetIMAPMailMessages>
        <Assign sap:VirtualizedContainerService.HintSize="513.3333333333334,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_2">
          <Assign.To>
            <OutArgument x:TypeArguments="x:Int32">[rowNumb]</OutArgument>
          </Assign.To>
          <Assign.Value>
            <InArgument x:TypeArguments="x:Int32">[0]</InArgument>
          </Assign.Value>
        </Assign>
        <ui:ForEach x:TypeArguments="snm:MailMessage" CurrentIndex="[rowNumb]" DisplayName="For Each email" sap:VirtualizedContainerService.HintSize="513.3333333333334,1587.3333333333333" sap2010:WorkflowViewState.IdRef="ForEach`1_1" Values="[email_list]">
          <ui:ForEach.Body>
            <ActivityAction x:TypeArguments="snm:MailMessage">
              <ActivityAction.Argument>
                <DelegateInArgument x:TypeArguments="snm:MailMessage" Name="email" />
              </ActivityAction.Argument>
              <Sequence DisplayName="Body" sap:VirtualizedContainerService.HintSize="511.3333333333333,1464.6666666666667" sap2010:WorkflowViewState.IdRef="Sequence_2">
                <Sequence.Variables>
                  <Variable x:TypeArguments="x:String" Name="senderEmail" />
                  <Variable x:TypeArguments="x:String" Name="senderName" />
                  <Variable x:TypeArguments="x:Int32" Name="mailNo" />
                  <Variable x:TypeArguments="x:String" Name="receivedTime" />
                  <Variable x:TypeArguments="x:String" Name="subjectEmail" />
                  <Variable x:TypeArguments="x:String" Name="bodyEmail" />
                  <Variable x:TypeArguments="njl:JObject" Name="jsonResult" />
                  <Variable x:TypeArguments="x:String" Name="sentiment" />
                  <Variable x:TypeArguments="x:String" Name="aiResult" />
                </Sequence.Variables>
                <sap:WorkflowViewStateService.ViewState>
                  <scg:Dictionary x:TypeArguments="x:String, x:Object">
                    <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                  </scg:Dictionary>
                </sap:WorkflowViewStateService.ViewState>
                <ui:MultipleAssign DisplayName="Multiple Assign" sap:VirtualizedContainerService.HintSize="477.3333333333333,302.6666666666667" sap2010:WorkflowViewState.IdRef="MultipleAssign_1">
                  <ui:MultipleAssign.AssignOperations>
                    <scg:List x:TypeArguments="ui:AssignOperation" Capacity="8">
                      <ui:AssignOperation sap2010:WorkflowViewState.IdRef="AssignOperation_1">
                        <ui:AssignOperation.To>
                          <OutArgument x:TypeArguments="x:Int32">[mailNo]</OutArgument>
                        </ui:AssignOperation.To>
                        <ui:AssignOperation.Value>
                          <InArgument x:TypeArguments="x:Int32">[rowNumb + 1]</InArgument>
                        </ui:AssignOperation.Value>
                      </ui:AssignOperation>
                      <ui:AssignOperation sap2010:WorkflowViewState.IdRef="AssignOperation_2">
                        <ui:AssignOperation.To>
                          <OutArgument x:TypeArguments="x:String">[senderName]</OutArgument>
                        </ui:AssignOperation.To>
                        <ui:AssignOperation.Value>
                          <InArgument x:TypeArguments="x:String">[email.From.DisplayName]</InArgument>
                        </ui:AssignOperation.Value>
                      </ui:AssignOperation>
                      <ui:AssignOperation sap2010:WorkflowViewState.IdRef="AssignOperation_3">
                        <ui:AssignOperation.To>
                          <OutArgument x:TypeArguments="x:String">[senderEmail]</OutArgument>
                        </ui:AssignOperation.To>
                        <ui:AssignOperation.Value>
                          <InArgument x:TypeArguments="x:String">[email.From.Address]</InArgument>
                        </ui:AssignOperation.Value>
                      </ui:AssignOperation>
                      <ui:AssignOperation sap2010:WorkflowViewState.IdRef="AssignOperation_4">
                        <ui:AssignOperation.To>
                          <OutArgument x:TypeArguments="x:String">[receivedTime]</OutArgument>
                        </ui:AssignOperation.To>
                        <ui:AssignOperation.Value>
                          <InArgument x:TypeArguments="x:String">[email.Headers("Date")]</InArgument>
                        </ui:AssignOperation.Value>
                      </ui:AssignOperation>
                      <ui:AssignOperation sap2010:WorkflowViewState.IdRef="AssignOperation_5">
                        <ui:AssignOperation.To>
                          <OutArgument x:TypeArguments="x:String">[subjectEmail]</OutArgument>
                        </ui:AssignOperation.To>
                        <ui:AssignOperation.Value>
                          <InArgument x:TypeArguments="x:String">[email.Subject]</InArgument>
                        </ui:AssignOperation.Value>
                      </ui:AssignOperation>
                      <ui:AssignOperation sap2010:WorkflowViewState.IdRef="AssignOperation_6">
                        <ui:AssignOperation.To>
                          <OutArgument x:TypeArguments="x:String">[bodyEmail]</OutArgument>
                        </ui:AssignOperation.To>
                        <ui:AssignOperation.Value>
                          <InArgument x:TypeArguments="x:String">[email.Body]</InArgument>
                        </ui:AssignOperation.Value>
                      </ui:AssignOperation>
                    </scg:List>
                  </ui:MultipleAssign.AssignOperations>
                </ui:MultipleAssign>
                <ui:AddDataRow DataRow="{x:Null}" ArrayRow="[{ mailNo.ToString, senderName.ToString, senderEmail.ToString, receivedTime.ToString, subjectEmail.ToString, bodyEmail.ToString }]" DataTable="[dt_Email]" DisplayName="Add Data Row" sap:VirtualizedContainerService.HintSize="477.3333333333333,223.33333333333334" sap2010:WorkflowViewState.IdRef="AddDataRow_1" />
                <ui:WriteCell WorkbookPathResource="{x:Null}" Cell="[&quot;A&quot; + (rowNumb + 2).ToString]" DisplayName="Write Cell Workbook" sap:VirtualizedContainerService.HintSize="477.3333333333333,148" sap2010:WorkflowViewState.IdRef="WriteCell_1" SheetName="[nameSheet]" Text="[mailNo.ToString]" WorkbookPath="EmailAssignment/AssignedEmail.xlsx" />
                <ui:WriteCell WorkbookPathResource="{x:Null}" Cell="[&quot;B&quot; + (rowNumb + 2).ToString]" DisplayName="Write Cell Workbook" sap:VirtualizedContainerService.HintSize="477.3333333333333,148" sap2010:WorkflowViewState.IdRef="WriteCell_2" SheetName="[nameSheet]" Text="[senderName]" WorkbookPath="EmailAssignment/AssignedEmail.xlsx" />
                <ui:WriteCell WorkbookPathResource="{x:Null}" Cell="[&quot;C&quot; + (rowNumb + 2).ToString]" DisplayName="Write Cell Workbook" sap:VirtualizedContainerService.HintSize="477.3333333333333,148" sap2010:WorkflowViewState.IdRef="WriteCell_3" SheetName="[nameSheet]" Text="[senderEmail]" WorkbookPath="EmailAssignment/AssignedEmail.xlsx" />
                <ui:WriteCell WorkbookPathResource="{x:Null}" Cell="[&quot;D&quot; + (rowNumb + 2).ToString]" DisplayName="Write Cell Workbook" sap:VirtualizedContainerService.HintSize="477.3333333333333,148" sap2010:WorkflowViewState.IdRef="WriteCell_4" SheetName="[nameSheet]" Text="[receivedTime]" WorkbookPath="EmailAssignment/AssignedEmail.xlsx" />
                <ui:WriteCell WorkbookPathResource="{x:Null}" Cell="[&quot;E&quot; + (rowNumb + 2).ToString]" DisplayName="Write Cell Workbook" sap:VirtualizedContainerService.HintSize="477.3333333333333,148" sap2010:WorkflowViewState.IdRef="WriteCell_5" SheetName="[nameSheet]" Text="[subjectEmail]" WorkbookPath="EmailAssignment/AssignedEmail.xlsx" />
                <ui:WriteCell WorkbookPathResource="{x:Null}" Cell="[&quot;F&quot; + (rowNumb + 2).ToString]" DisplayName="Write Cell Workbook" sap:VirtualizedContainerService.HintSize="477.3333333333333,138.66666666666666" sap2010:WorkflowViewState.IdRef="WriteCell_6" SheetName="[nameSheet]" Text="[bodyEmail]" WorkbookPath="EmailAssignment/AssignedEmail.xlsx" />
              </Sequence>
            </ActivityAction>
          </ui:ForEach.Body>
        </ui:ForEach>
      </Sequence>
      <FlowStep.Next>
        <FlowStep x:Name="__ReferenceID3" sap2010:WorkflowViewState.IdRef="FlowStep_5">
          <sap:WorkflowViewStateService.ViewState>
            <scg:Dictionary x:TypeArguments="x:String, x:Object">
              <av:Point x:Key="ShapeLocation">525,375</av:Point>
              <av:Size x:Key="ShapeSize">110,70</av:Size>
              <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,445.15384615384613 580.0153846153846,475</av:PointCollection>
            </scg:Dictionary>
          </sap:WorkflowViewStateService.ViewState>
          <ui:ReadRange Range="{x:Null}" WorkbookPathResource="{x:Null}" AddHeaders="True" DataTable="[dt_Email]" DisplayName="Read Range Workbook" sap:VirtualizedContainerService.HintSize="110,70" sap2010:WorkflowViewState.IdRef="ReadRange_2" SheetName="[nameSheet]" WorkbookPath="EmailAssignment\AssignedEmail.xlsx" />
          <FlowStep.Next>
            <FlowStep x:Name="__ReferenceID0" sap2010:WorkflowViewState.IdRef="FlowStep_6">
              <sap:WorkflowViewStateService.ViewState>
                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                  <av:Point x:Key="ShapeLocation">525,475</av:Point>
                  <av:Size x:Key="ShapeSize">110,70</av:Size>
                  <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,545.1538461538462 580.0153846153846,575</av:PointCollection>
                </scg:Dictionary>
              </sap:WorkflowViewStateService.ViewState>
              <Sequence DisplayName="SentimentClasification" sap:VirtualizedContainerService.HintSize="110,70" sap2010:WorkflowViewState.IdRef="Sequence_3">
                <Sequence.Variables>
                  <Variable x:TypeArguments="x:String" Name="sheetName" />
                  <Variable x:TypeArguments="sd:DataTable" Name="dtData" />
                  <Variable x:TypeArguments="x:String" Name="cleanJson" />
                </Sequence.Variables>
                <sap:WorkflowViewStateService.ViewState>
                  <scg:Dictionary x:TypeArguments="x:String, x:Object">
                    <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                  </scg:Dictionary>
                </sap:WorkflowViewStateService.ViewState>
                <ui:ForEachRow ColumnNames="{x:Null}" CurrentIndex="{x:Null}" DataTable="[dt_Email]" DisplayName="For Each Row in Data Table" sap:VirtualizedContainerService.HintSize="542,3198" sap2010:WorkflowViewState.IdRef="ForEachRow_1">
                  <ui:ForEachRow.Body>
                    <ActivityAction x:TypeArguments="sd:DataRow">
                      <ActivityAction.Argument>
                        <DelegateInArgument x:TypeArguments="sd:DataRow" Name="CurrentRow" />
                      </ActivityAction.Argument>
                      <Sequence DisplayName="Body" sap:VirtualizedContainerService.HintSize="540,3023.3333333333335" sap2010:WorkflowViewState.IdRef="Sequence_9">
                        <sap:WorkflowViewStateService.ViewState>
                          <scg:Dictionary x:TypeArguments="x:String, x:Object">
                            <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                          </scg:Dictionary>
                        </sap:WorkflowViewStateService.ViewState>
                        <TryCatch DisplayName="Try Catch" sap:VirtualizedContainerService.HintSize="506,2963.3333333333335" sap2010:WorkflowViewState.IdRef="TryCatch_1">
                          <TryCatch.Try>
                            <Sequence DisplayName="Try" sap:VirtualizedContainerService.HintSize="504,2422.6666666666665" sap2010:WorkflowViewState.IdRef="Sequence_6">
                              <Sequence.Variables>
                                <Variable x:TypeArguments="x:String" Name="emailBody" />
                              </Sequence.Variables>
                              <sap:WorkflowViewStateService.ViewState>
                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                  <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                </scg:Dictionary>
                              </sap:WorkflowViewStateService.ViewState>
                              <Assign sap:VirtualizedContainerService.HintSize="470,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_8">
                                <Assign.To>
                                  <OutArgument x:TypeArguments="x:String">[emailBody]</OutArgument>
                                </Assign.To>
                                <Assign.Value>
                                  <InArgument x:TypeArguments="x:String">[currentRow("Body_Email").ToString.Trim]</InArgument>
                                </Assign.Value>
                              </Assign>
                              <If Condition="[String.IsNullOrWhiteSpace(emailBody)]" sap:VirtualizedContainerService.HintSize="470,2245.3333333333335" sap2010:WorkflowViewState.IdRef="If_1">
                                <If.Then>
                                  <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="468,285.3333333333333" sap2010:WorkflowViewState.IdRef="Sequence_4">
                                    <sap:WorkflowViewStateService.ViewState>
                                      <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                      </scg:Dictionary>
                                    </sap:WorkflowViewStateService.ViewState>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_9">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:Object">[currentRow("Sentiment")]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:Object">["N/A"]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_10">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:Object">[currentRow("Category")]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:Object">["N/A"]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                  </Sequence>
                                </If.Then>
                                <If.Else>
                                  <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="468,1829.3333333333333" sap2010:WorkflowViewState.IdRef="Sequence_5">
                                    <Sequence.Variables>
                                      <Variable x:TypeArguments="x:String" Name="prompt" />
                                      <Variable x:TypeArguments="uwahm:HttpResponseSummary" Name="respondString" />
                                      <Variable x:TypeArguments="x:String" Name="emailBodyEscaped" />
                                      <Variable x:TypeArguments="uwahm:HttpResponseSummary" Name="responseObj" />
                                      <Variable x:TypeArguments="x:String" Name="jsonBody" />
                                      <Variable x:TypeArguments="x:String" Name="resultObj" />
                                      <Variable x:TypeArguments="uoic:GenerateTextCompletion" Name="gptResult" />
                                      <Variable x:TypeArguments="x:String" Name="aiRespond" />
                                      <Variable x:TypeArguments="njl:JObject" Name="jsonResult" />
                                      <Variable x:TypeArguments="x:String" Name="sentiment" />
                                      <Variable x:TypeArguments="x:String" Name="category" />
                                    </Sequence.Variables>
                                    <sap:WorkflowViewStateService.ViewState>
                                      <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                      </scg:Dictionary>
                                    </sap:WorkflowViewStateService.ViewState>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_11">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[prompt]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String">[CurrentRow("Body_Email").ToString]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,118.66666666666667" sap2010:WorkflowViewState.IdRef="Assign_12">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[jsonBody]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String" xml:space="preserve">["{
  ""model"": ""gpt-3.5-turbo"",
  ""messages"": [
    {
      ""role"": ""user"",
      ""content"": ""Phân tích email sau và trả về kết quả dưới dạng JSON với hai trường: 
      - 'category': thuộc một trong các nhóm ['complain', 'compliment', 'quotation', 'technical support', 'spam', 'phishing']
      - 'sentiment': 'positive', 'negative' hoặc 'neutral'.
      Chỉ trả về JSON đúng định dạng, không kèm theo giải thích.
      Ví dụ:
      {
        'category': 'complain',
        'sentiment': 'negative'
      }.
      Email: " &amp; emailBody.Replace("""", "\""") &amp; """
    }
  ],
  ""temperature"": 0
}"]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <isactr:ConnectorActivity Configuration="H4sIAAAAAAAACu1d63LbOLJ+FZT/nGTLVmTnOqma2pJlO1ZsyxpdkrOzM5WCKUhiRJEcXmwrqTzO/jjPsS92vgZACeBFVJzrnuPa2onMbjSA7kaju9EgP+6cuMIbx+3AT7jri2jn5cedgeCRM+NXnlDAnZf//HN3p+OHabJ68HGnyxdi5+VOn0/74q9UxMnO7s6RG4ceX5aCROxEbpi4ga9ATMMYgMNlSA3iJHL9Kf4eBFFyGY1pOAfUdMJTL3nDvZSwPjL2x84kota+s3wXCp97yfKPnZdsf5dAC377Lgnmwo/p2dNmUz711whhJGI0FcWmYRQswoT+/mPn7cx1ZiyIptx3P3AaN5sFmDxLZoJ5go8xVBYGsStBri+fT4g/LJiwfnAVJK7DelHgiDhmrTQJForKg36v9fDvf+zIHl0fk04dAqhu/xGkjEeCcZCcBJFqwz2GoV274Ihul4hFKCKepJGgds3GU/U4CN+Fcj6fFM/dKdj9cacTn7rjscBv9CY+7SqxnweOJA+mXoDBbsgjElUnvhDJLBj3eARBJiQF1Wol9EUwFp78nZf5BUGYr0GWzIfgDwHAU9Y5IiYRxyQpejQWoRcsF8JPWBKwNAYz8ZRQoIsJcyAZT0hSG/Xl6e7OsZ8uTBWdhsnek2DvoHnwZG9/H/+iRaZMRZgxTQ1cuL6rMJrP9/ZfFFvnEUwSQgEbzb2Jx+PZXrO5bxIoAxvNHY+nY7H3eO/pXhz4vkiMttxPZlEQuk6jgCUH03x20Ny73n9pTamIen0AjO2p7jcPDlSbT3+aGnYe8PHhUi/VlZrRGncjMVYPimr3Wyqi5VYqp5ZmQd96q8cFXYMKRbRsAK9SJRat7NMGlXpWP4/DYLw02ezGvU7n2CcbOi6OudOBtidCrvrC0N/OwAmMHItAITHCn2AecgYumWE9rQZjmuGwSgGbcC8WjfVcroIAdsq3J/M8b09lK1OSPW3TJHfdBYeAPlXMmAQnAS05F0gPy7cgOhc4HmRaw5KJRFLct1nSmbBYSLMguc+4v9S8EWPizqPeaYfduJ7HrmBQeDzH4ysBmQu086Whprbg3vn5RYOBnJq0RWRFwPUdD4o/zmz6itcdn8Goz5jDYxHvSlgpAX7NXY/mmVEI0gRCA4VukAg8gQ661pQk1l8p99xkmRlG1QjTWcpBLUJOHdWJ90WteA15qY1c/dZEB7PgBhT7qScUtC8mskW5YnfiNsYgF4buqBO/DaL5xAtujm9po42lCDUwIybHRvRp8n9++pOUxRoGditxt2Go9fl5o5DPaRiwaBu0/55pVUyrM4ce96cpn4o2NvvStZ8hlBryDJitDG3TlSXk/jhbKlhMscN9aexBtLHZqv9SdBRak8idc451YeyHE3MircWMR65jwhcWPOJXNjiywHGMH7EwEWIL4YOIrrj7Hj6nifPBxDlMvSkGIVd+hnE1tTCEP4UtMeG+BQ9iP9feGkWbJ9yz4A634B+EMzOhVuu3wostqKUKR5iaBR5bpF8JuLxmz1AYExwJMTegwjOhx/7Us4nD4zXggzDfOTTZbB8nQY4x8LhMxvEY/oIJTk1wT0Sx3XxiTe7E9XP9T1wLju3TYuzE0p5OZDee2pyDxB2796nFnVfpe3hXiakWU2v4p+IqEjcGeGbx/tTFVmpCrbG3owC0re5n1uhPU7+gtjOr/1YE7z+HYOlOB2ppw11LPB1/HPjY6GyUsYnymkMH7BX4PqeACPlsCnML4Yx/4HNTDPO5BZ4tYF0MqGUfzrjvc2i8Abc09Aw+i913YIHTaAwdYA/wA8vkvfvQRLWYebaMpssPJthi5TkPDJhn9XLuJrMUK8UaCJx6q3lynYNfm/AL2I8pj5cGwsIyURfcERCWTWMxz9NY4v8LE8PS6IvAnwY5jVhY/LwgjYeiGvCo0IcJtezBIbhs68rCYmJXhLaZ9a0Fc5Qm1mr2rcF3g+hGkKaxB4fBfPHvf3mmMH1LIpdj19SZwJpDL/XfY9cx4KGlsD2wyLIboTWOHsLOxFSG0OJBDztmOsWWLzDOiH9wrWEi/j3sV6Gr3zzfoDc0G/SRFsmpQWTNvZ/Ce7PhlqIPvOCam3tCPM+D81YlthgwwAgsKcZW/y3vKj/A+C+rPbbsHNySz+AGXDOhFn8HN4KWtAm/zrWeufbwbkz4kC9cz4AmluyHwoM0TLClocMZNyknMwuYRnN7ZIk1r9FyOktNU5daK3w0j5BRtBmTWqIZRWNzaKBlAj9cWTt9avlAb1yRUC7JWpzX9oY0Qz4zFnsDhE6ei8Tc2ED9MNubkZ9Xgj+MkNpTSbdCg6Q+6UFeJYUlI2QfLq9FFFEkY2YN7qOI+9DrO4Zeoese+wnyCnDqxTSIXBH/829/lgVhMoviKKxlaSAWhDoZncem/K2zok+BGAfa8oPM4VLmZML8IKGMB5I3SJIYuFnSJBLXroAtrIna9pvFsI3cbplIyxarfpDzzJHuS4hwHk/2ZuLO4EQy9HFlOXLycVc9Nbdm44DAwLYem7vJeEziNTCzJ2YcskACyUBRf5vGsX9ugOkv0wvusWIvnV5JP0cQw6OhK3P1GSI9k48MvN/gDZIKGWirR+bcDlssQixO+bYC+wDsK1iRh4O3nZMh0rIyOZA1kA9lwsCKMrBbIoPLI9Oaq6dtPCzS7vhIKvrZKcoh9+c0vJbjBClOGjS+wScTXWNr5CLtVjRFvtP1OetmHXRwyEJ8YQ+Oup2HRfqtfoaaYZaQTUnzcQCU0cpNtzXM2tKUy1om/Fa3nrjKMpQIZDjktx0LqXooshGpFVKdaMYevGkNH5bRlL8kHtAq6FEQx+BUzRnXYigSGhHvqxmfkUFGNo1p345LaWjYpnG0kUuifHJRUiMN2tR6HLnY4/8rZoi9ceBo6m9rdCSB8bkCbSKzgP460J4N/LhQKPUsYSGP4xAWs4xKT8M2tSflQS6+xAS2RhAqcvklczkU3tRNFzjg0wuh0PjwONP8rVuzNwcbCABYQmJLTT08rtFUFevgoBcBDNPrUI/qQbvbe20GNYf9c0JT+2wlqXbvpGQcfTyubLI2K0eM1jrOjl/ZHa+syVH/lZ3CozxDzSprtzauMk0jr+NldOpUXZOaCZy3z+AHRNfALCN0KjEGCqGSTrWKt1vVKq4bq10fTFV9aZO9MpSqHaLX0073oU1ZN1Tt7GYl/cQB0nEe0tRxGnGUG5QNdiBxOhlKyZgR/Al7Jyihc25uCKVEsEf1EbYQ2nqPUirV67dLFki7m+Fvpn08wiHYld6Ti2SOR0cErW5bq1ygUKNcIPOqN4D/ECA7BhMCH9lsDljbANkNVxanbrs8Htkbd/WeCarV+nm8wQSjodIHNhBOGpGEMmUcDLoPycmmY+hr7kkpHllkVcusYSlxMocVyj60df2YDH3dPE+UVtdL8KRfJ0FNSpuHDSvmpK8XX/WK0bR8w3RK1YTV7phzPDFsZ0n7ahGe9KtFqBtXibHTHRwf24Ook5umWOnRsQdo8+//iQI26OXmt70Mt9w0T/o1m6Y6vWFHmUpogRedq6PjOpVQpJY5Y1VCaLN5yshUi/PouFqcWevKlWPR2YLfGcE8w0uorVldJHOKxDc7o//kbPnpWeeoJOo4HWV7V90A1SmNmnFO30qobjHjjGDtjE9Hm2aMox24pj3JPrJ+dgCHTaxlGbBOd4WqMYvERr6Lw7y8XB+0+HjGeVTCxU5XNamb8uoYKi+ds2GvjOzRZhXuRAKHseO139JLr2BrYV2UF/Wg1xuUkT3OGij8Sp/qc+iz64Ntu7Dd804ccWE5tCad83JTrBuRk7ohYj/f6MTSmeGyaJHs/od11khROXFRXwBH3k5UdIbqeT5XIY8aawb/urdx8IpEvTl93aubgKJ0sd6KQi05c9W87l3oHSiT60YS7SCC2YRTVU5jBS4SWbmifZyAUdxZbmA6dekEixpUtXyPeN1bYZSvMEVGb9or12LtfNnO0eterdd+nt6KxVWQRtN8ZqjgeQEOKqjvlRyPzY7ON7qcuuFduw38Pf/OXeNHsXecpSZ5k1eQxYWVuypyThHZZr+9kPmroyKJrrhhv8NLJJu2efV1f9+4+kxC9Wuw+3vdGjTpdXz5T1/gcDItpaYwNMJmYhc4Z8MqkqWDOqgtIZhhXU4UzmaaejWgmGdC5egl9BSGRigS69GxZRhSAo62WjqAY7LKfK+XwjBIG1wk2zvVuBJVY5ZJOTtcZm0c1n0QfoW+9YYaXq5uKyrbaFxvm4zpAEnuGaNKMofXUvy9tR05WRayrdU862eIJl4J6RDnswxpajPwG9DfBaRNYanVui6aUeS2YfbxYBtm37jI/FaMrnX6xsxnnNaNbcjdG2wD5S7K8G25i6IbrUTTFpEeMBynVr/9aIj/mDwavs1wDdQSillQUuTM8G11wDJqnDW2sFWjszpbJQmtWKGNysoj7J6WeZyjs6xBlYGxqRZ32m6ne/mwlOKGzVYS1c48dCbkS5DCmamgarrSySvkDLeM4qCxrc6PanVeUttCJoN6mYAQkkBywtX6MRqMzjZpCIhQAHTtjlFwvuZYhaPQyaWGRoN146xtdSpUzz2dsmO6zeQIeb+nhWMzh47IjlslakToBrZCrpjI5v19NCjZ360Cjk4s95mB8ISzKuC4r+q4L6j/yas6nMCfqIhmOANhuphYVtLB1ngsduBElJZ10BW0BY7O8sjydhTdeqJ7LEigq0tJ8prKZMl4LC+9kK8oyzfG8n7KunpjlWgzqzf2MTV5qREI4wBJAzUi88JKs/H86f19lbvcV8EWFPjj+xsrX2OBGfdyCwtrsIwTsdDXUEpXVGxiyOKoAHUlt3RnZUU2u81ypyuJ+8Vr0euLwzPhhZMU1QQwOHFCVYt3vt53ibjJv+Zx4U5fEoRnBcYMg5DNCwxpZScVVyK5EYjU9qXReNJEYRgxa+ZO5X1Huh6sEBP7KdwNulihrsbBG6B7zzBKxNCGdQESJNdsc8HxacEAPTYMEDAeUzrTZiSINL/efTnzpvSXXparuky8/UXgu1y1q5jBXXa40pvYFXeov6l5u5fKl0llC/eEVucrVAPK67cFS9HW9nBqYlhWQ7W17/utzCjWuus7yInE62uzZFNQ6YIo0cndoZV2xo3ZRMj3JVAFanATy/vh0mzAKCMUp25ClKQmdFq1qirzgimOQoj23A9u4OdN6Vavvk28vhlMt3kphBDjXU2XLiJGqyAUf1xGzgx2HbYL+8Fh6sxFwm5g4mDfAielSCdmM34tYCZhI9PQQ205rByQ1W8YdlmVNYZH5iQ4jaBrjlSpmqBakzqtq5x9UtgykMelVb2qp7WekzhXyZhbbCRUN+n6Y3FrgagcDBONkXV2RC66+uo3yYkBBV2iERQ3HccRIThKwPiR29cDJK8VspBXRxtaK2gCWRUy2AidC7RelmvfLrQjUS2oqBmtKIEOBlFTEiifoIa0Ibtmq45n1DN72sRJNFQIIgwWkDlJ2HMXKJ958Lh5cfgQaYc0pMAdz9XbP+KXrHd0ssteDy67u6w9eLPLji7bg102/O+hIXHNGVPeX9GLLlnPX7yZ2Ypzl51p86jutEHlFH1XLYWywa3eCPHTse1SV+n/tKy7g7b9KPX5ARryI0X+OdP9Ru9KuDc196bm3tTcm5qcqfmy95VNkB8V0ZlYFpxHyys/kWg4WklmBYfSQlT0pENId1zp/ULy1UwwkeQ9ZmGK9iJvXElvk2/+jE4dgnkakq92efUeHr41dKpoVgirU145GTnUlzuP8ljUWO0dqectf5MpWxyqS5owMHVXWDeb8B/l+uT2op/I97F36K/r+nwPtv0AT3trln01N+o7qs/31ZAfJvLPmOYdvcV7U3Nvau5Nzb2p+UxTc/fXjOJcq1d6rhXWn2s1ZZ54Xx9rYSO0TrXUCyNhbem1pPQT5UzjYEFZZvsUq9l40ag5Rn++zTG6fBXk/SnW/SnW/dni3U6xpPMkq0Btc9DRqTDbHHQLr7ZexYNlpwk1AeGLyoBQUhXFgFC/czuLCDXa31eh768fVz8/FeNE/6tEhnXOqxmHf3Fc87c7+bUVQ6iNYe4YmXyHGf9sMe8dXX05mm/Eyks/ozUKx1RvXRnAlLP4Xq/v9XqbHWP96YnCpnHBb2WRpQIzdSe1tBpTI2rnkvYS1YQ2El38lL1YfF02pp1OiaqIU8slFme25YReSt+uoIs3q5fJY53Atj8yqs9QtkCH2uLWEeo4m13Li7v68xPyVBqP5bk5eIFS8gRF7Vf0HQ96/TK90pyAqhGe0OvQpdNLrz33jS8+ZNNUY40DOpkHvqyAiANspVGAQWbv7ddzMKZXW+n1i13p9exJVRVcsa7oc+rg1t/hKIYNNqwgacWkrAwQdQOJe02VLBNU0lJtR8RiTu8upPTympT+OkaDnaoKOUklZgvBSUdW/JX1CQmf099UyuvGc8QZQ9S2NBu/SL7K57pbqQoh7DIoyXLFTCFietv+GKHNA1hSZLZROwMl4NEU8lsN72FWi0Kvc0tmkPiN8Ly9sZigiEaWsMi+xC0mBnIxAiOtr0qhvXU9hLp84Kp3yNH3AHbX2jpWroiaMYVTQNP60U0dT0C/BzQizVlVpyFLNOit/YpPdqi1vznOOmhuE2c1v4VeFb5vUyx7yTCYgWF7pHZ4SnWDUpj4t8HUQCF4rT+SiPsB0aq4ySzOFeqrID65bN0I8tNZxdXgMjskTzugHhMOeY2FrMzKTkWkOsrXg8yF586CQBbYRCKE4kkEeiU6oKhkQpnnFRi0yMXDNSv9YL90pX8HISmduZygyIcGWxCRFgBWeLTGsL9sAW+MLoCplevn8bUFjQQWPlZSnc07OKjlxOOvWdz6Y87q/wOcsW/gbv/frLu4l2Xt+1tzHysrGJmeRvgO28BN9mmimUC9bQgLHpXuALo2d/MOkHBvzvgVSnR1Xyhgz2dC6+zd4x9m+Usqmtc+9CxwHbHJx18beqfYzPTzM/9XXwqhklXraoThQmYuucozS4fL3lOyMILum0jvcApvnQpelYs3k0okAWr3IdHyrDMniFH4CgEn2Ze1fAQI2QbFb+jmiRwGEQcpCgWkr1Axyko/rFzQT2oFvf9tBC0/qPctDwQmQj5VsiEuYrB0Pxxm9zN59PRzefQz3aH4vCsIP/QOy9e4hPMfcrPl/59U6rbjGAahYA4GeAiDJ2OiYqg/CuXdtBVCrK990Opv9fRn44huZvZliJVG+iuAZBiU3c/CALXZri4g6Co0FUuZI7Hth49KsJorIgfPvoUJvd1LUamXzPbceC9O0MrZS4QncP4aLfdQwscXe8gLyNSHVgabu6RTMi+SQXMXPQyo2i8z4iWTzY/9VHCa+TYnw+Y0Imzs7kLk51GMAPsKkQ0zRBQXZoj2B3GrEb94DlDrS3kRqvj1XtKkwqAZbW/2PctSL2aoADV1jdkngNdrVyWa1jl49Xc7ld1VfWFTzWCTnqkPP+pB5ZOv8puQFTPJfBJKSkhnmhZM7lObes3KV0kGCb3uQn0GgSFjBScJyUt5bQsUPPqykcqD6U9RykczVaFZd0nr+Xdk2Gs3eXd98PJlJuo2nLe1G1vi4cLtQK72lbZSJd8uXU9u5NJBZINepz9VyPrlMQ29YF3k4gZv5Suz6Wf7oNVqHj07fP7kBcb0Lk6v3pUP612bMpaicYgw1RONbXB3WRn1xvvm49N/nJ6Lf3T33/Tfv7j0W69e/3Kwy97Qba7A/xXeEv0PrWFCkXj91RcpvSJ9V78gERmGIVnnX8my7tTLbUsB0TqGZCR2QWT5KL3tkkFFL4NMmXIyy+DYGUo/rUrruHAZkznFZnml3ebLv99Qi+mouuPT7XZHrOwdgB93tPjQVgoQTTE/H+fngcwJvdzRZlz/w91oTHfWs30kO43Uw9q1D983LpfTJAmVBaawHAET7ZY0FwqopUu32uMqVlObo8h8bJzr04w+Zc8Po+AGkVcHhwH6uc7+YF76I+097sz5VJg82H9hMyF7fY5coNR9q8PWa9LENKk8w6nBihlb2IXtuXYpDzZUP2q9Flh5ORgalQ3XB48qiZ1n3xGVn37cpVO3Hv4cQACUzkf4c8rjQ/RC3/VAa39KLNYqSlvHoRc4c8nMT/8LbosXcBx/AAA=" ConnectionId="cbd98208-e25c-4781-9995-dd2aa0d6b748" DisplayName="Content Generation" sap:VirtualizedContainerService.HintSize="434,428" sap2010:WorkflowViewState.IdRef="ConnectorActivity_1" UiPathActivityTypeId="aba52a00-4c05-318d-8f99-5ad924b2f277">
                                      <isactr:ConnectorActivity.FieldObjects>
                                        <isactr:FieldObject Name="modelName" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:String">gemini-2.0-flash-001</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="prompt" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:String" xml:space="preserve">["Phân tích email sau và trả về JSON với hai trường:
- 'category': bắt buộc thuộc ['Chase delivery','Return','Collaboration','Compliment','Quotation','Financial Support','Application','Spam','Phishing','Others']
- 'sentiment': phải là 'Positive','Negative' hoặc 'Neutral'.
Chỉ trả về JSON đúng định dạng, không kèm theo giải thích.
Email: " &amp; CurrentRow("Body_Email").ToString]</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="isPIIEnabled" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:Boolean">False</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="isFilterPIIEnabled" Type="FieldArgument" />
                                        <isactr:FieldObject Name="languageCode" Type="FieldArgument" />
                                        <isactr:FieldObject Name="piiEntityCategories_array" Type="FieldArgument" />
                                        <isactr:FieldObject Name="confidenceThreshold" Type="FieldArgument" />
                                        <isactr:FieldObject Name="topK" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:Int32">40</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="contextGrounding" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:String">None</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="_file" Type="FieldArgument" />
                                        <isactr:FieldObject Name="folderKey" Type="FieldArgument" />
                                        <isactr:FieldObject Name="topP" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:Double">0.8</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="indexID" Type="FieldArgument" />
                                        <isactr:FieldObject Name="numberOfResults" Type="FieldArgument" />
                                        <isactr:FieldObject Name="top_p" Type="FieldArgument" />
                                        <isactr:FieldObject Name="instruction" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:String">You are an assistant that classifies emails Into categories And detects sentiment.</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="max_tokens" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:Int64" />
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="temperature" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:Double">0</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="frequency_penalty" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:Int64">0</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="presence_penalty" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:Int64">0</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="n" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:Int64">1</InArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="_stop" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <InArgument x:TypeArguments="x:String" />
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="out_text" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <OutArgument x:TypeArguments="x:String">[aiRespond]</OutArgument>
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="out_maskedText" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <OutArgument x:TypeArguments="x:String" />
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="Jit_v2_sub_generateChatCompletion" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <OutArgument x:TypeArguments="uiascb:v2_sub_generateChatCompletion_Create" />
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                        <isactr:FieldObject Name="out_contextGroundingCitationsString" Type="FieldArgument">
                                          <isactr:FieldObject.Value>
                                            <OutArgument x:TypeArguments="x:String" />
                                          </isactr:FieldObject.Value>
                                        </isactr:FieldObject>
                                      </isactr:ConnectorActivity.FieldObjects>
                                    </isactr:ConnectorActivity>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_7">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[cleanJson]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String">[aiRespond]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_4">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[cleanJson]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String">[System.Text.RegularExpressions.Regex.Match(aiRespond, "\{.*\}", System.Text.RegularExpressions.RegexOptions.Singleline).Value]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_13">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[cleanJson]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String">[cleanJson.Replace("category:", """category"":").Replace("sentiment:", """sentiment"":")]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_14">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[cleanJson]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String">[cleanJson.Replace("`", "").Trim]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <ui:DeserializeJson x:TypeArguments="njl:JObject" JsonSample="{x:Null}" Settings="{x:Null}" DisplayName="Deserialize JSON" sap:VirtualizedContainerService.HintSize="434,176" sap2010:WorkflowViewState.IdRef="DeserializeJson`1_1" JsonObject="[jsonResult]" JsonString="[cleanJson]" />
                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_5">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[sentiment]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String">[jsonResult("sentiment").ToString]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_15">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:Object">[CurrentRow("Sentiment")]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String">[sentiment]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_6">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[category]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String">[jsonResult("category").ToString]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_16">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:Object">[CurrentRow("Category")]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String">[category]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                  </Sequence>
                                </If.Else>
                              </If>
                            </Sequence>
                          </TryCatch.Try>
                          <TryCatch.Catches>
                            <Catch x:TypeArguments="s:Exception" sap2010:WorkflowViewState.IdRef="Catch`1_1">
                              <ActivityAction x:TypeArguments="s:Exception">
                                <ActivityAction.Argument>
                                  <DelegateInArgument x:TypeArguments="s:Exception" Name="exception" />
                                </ActivityAction.Argument>
                                <Sequence DisplayName="Body" sap:VirtualizedContainerService.HintSize="504,285.3333333333333" sap2010:WorkflowViewState.IdRef="Sequence_7">
                                  <sap:WorkflowViewStateService.ViewState>
                                    <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                      <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                    </scg:Dictionary>
                                  </sap:WorkflowViewStateService.ViewState>
                                  <Assign sap:VirtualizedContainerService.HintSize="470,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_17">
                                    <Assign.To>
                                      <OutArgument x:TypeArguments="x:Object">[CurrentRow("Sentiment")]</OutArgument>
                                    </Assign.To>
                                    <Assign.Value>
                                      <InArgument x:TypeArguments="x:Object">["Error"]</InArgument>
                                    </Assign.Value>
                                  </Assign>
                                  <Assign sap:VirtualizedContainerService.HintSize="470,108" sap2010:WorkflowViewState.IdRef="Assign_18">
                                    <Assign.To>
                                      <OutArgument x:TypeArguments="x:Object">[CurrentRow("Category")]</OutArgument>
                                    </Assign.To>
                                    <Assign.Value>
                                      <InArgument x:TypeArguments="x:Object">["Error"]</InArgument>
                                    </Assign.Value>
                                  </Assign>
                                </Sequence>
                              </ActivityAction>
                            </Catch>
                          </TryCatch.Catches>
                          <TryCatch.Finally>
                            <Sequence DisplayName="Finally" sap:VirtualizedContainerService.HintSize="504,90.66666666666667" sap2010:WorkflowViewState.IdRef="Sequence_8">
                              <sap:WorkflowViewStateService.ViewState>
                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                  <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                </scg:Dictionary>
                              </sap:WorkflowViewStateService.ViewState>
                            </Sequence>
                          </TryCatch.Finally>
                        </TryCatch>
                      </Sequence>
                    </ActivityAction>
                  </ui:ForEachRow.Body>
                </ui:ForEachRow>
              </Sequence>
              <FlowStep.Next>
                <FlowStep x:Name="__ReferenceID1" sap2010:WorkflowViewState.IdRef="FlowStep_3">
                  <sap:WorkflowViewStateService.ViewState>
                    <scg:Dictionary x:TypeArguments="x:String, x:Object">
                      <av:Point x:Key="ShapeLocation">525,575</av:Point>
                      <av:Size x:Key="ShapeSize">110,70</av:Size>
                      <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,645.1538461538462 580.0153846153846,685</av:PointCollection>
                    </scg:Dictionary>
                  </sap:WorkflowViewStateService.ViewState>
                  <ui:WriteRange StartingCell="{x:Null}" WorkbookPathResource="{x:Null}" DataTable="[dt_Email]" DisplayName="Write Range Workbook" sap:VirtualizedContainerService.HintSize="110,70" sap2010:WorkflowViewState.IdRef="WriteRange_3" SheetName="[nameSheet]" WorkbookPath="EmailAssignment\AssignedEmail.xlsx" />
                  <FlowStep.Next>
                    <FlowStep x:Name="__ReferenceID6" sap2010:WorkflowViewState.IdRef="FlowStep_7">
                      <sap:WorkflowViewStateService.ViewState>
                        <scg:Dictionary x:TypeArguments="x:String, x:Object">
                          <av:Point x:Key="ShapeLocation">525,685</av:Point>
                          <av:Size x:Key="ShapeSize">110,70</av:Size>
                          <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,755.1538461538462 580.0153846153846,785</av:PointCollection>
                        </scg:Dictionary>
                      </sap:WorkflowViewStateService.ViewState>
                      <ui:ReadRange Range="{x:Null}" WorkbookPathResource="{x:Null}" AddHeaders="True" DataTable="[dt_Email]" DisplayName="Read Range Workbook" sap:VirtualizedContainerService.HintSize="110,70" sap2010:WorkflowViewState.IdRef="ReadRange_4" SheetName="[nameSheet]" WorkbookPath="EmailAssignment\AssignedEmail.xlsx" />
                      <FlowStep.Next>
                        <FlowStep x:Name="__ReferenceID5" sap2010:WorkflowViewState.IdRef="FlowStep_8">
                          <sap:WorkflowViewStateService.ViewState>
                            <scg:Dictionary x:TypeArguments="x:String, x:Object">
                              <av:Point x:Key="ShapeLocation">525,785</av:Point>
                              <av:Size x:Key="ShapeSize">110,70</av:Size>
                              <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,855.1538461538462 580.0153846153846,895</av:PointCollection>
                            </scg:Dictionary>
                          </sap:WorkflowViewStateService.ViewState>
                          <ui:ReadRange Range="{x:Null}" WorkbookPathResource="{x:Null}" AddHeaders="True" DataTable="[dt_Department]" DisplayName="Read Department Infor" sap:VirtualizedContainerService.HintSize="334.00000000000006,88" sap2010:WorkflowViewState.IdRef="ReadRange_3" SheetName="sheet1" WorkbookPath="Department\Department_List.xlsx" />
                          <FlowStep.Next>
                            <FlowStep x:Name="__ReferenceID4" sap2010:WorkflowViewState.IdRef="FlowStep_9">
                              <sap:WorkflowViewStateService.ViewState>
                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                  <av:Point x:Key="ShapeLocation">525,895</av:Point>
                                  <av:Size x:Key="ShapeSize">110,70</av:Size>
                                  <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,965.1538461538462 580.0153846153846,1015</av:PointCollection>
                                </scg:Dictionary>
                              </sap:WorkflowViewStateService.ViewState>
                              <Sequence DisplayName="Assign to" sap:VirtualizedContainerService.HintSize="540,4855.333333333333" sap2010:WorkflowViewState.IdRef="Sequence_10">
                                <Sequence.Variables>
                                  <Variable x:TypeArguments="x:Int32" Name="index" />
                                </Sequence.Variables>
                                <sap:WorkflowViewStateService.ViewState>
                                  <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                    <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                  </scg:Dictionary>
                                </sap:WorkflowViewStateService.ViewState>
                                <ui:ForEachRow ColumnNames="{x:Null}" DataTable="[dt_Email]" DisplayName="For Each Row in Data Table" sap:VirtualizedContainerService.HintSize="506,4795.333333333333" sap2010:WorkflowViewState.IdRef="ForEachRow_2">
                                  <ui:ForEachRow.Body>
                                    <ActivityAction x:TypeArguments="sd:DataRow">
                                      <ActivityAction.Argument>
                                        <DelegateInArgument x:TypeArguments="sd:DataRow" Name="CurrentRow" />
                                      </ActivityAction.Argument>
                                      <Sequence DisplayName="Body" sap:VirtualizedContainerService.HintSize="504,4620.666666666667" sap2010:WorkflowViewState.IdRef="Sequence_24">
                                        <Sequence.Variables>
                                          <Variable x:TypeArguments="x:String" Name="category" />
                                          <Variable x:TypeArguments="x:String" Name="deptDict" />
                                          <Variable x:TypeArguments="x:String" Name="deptEmail" />
                                          <Variable x:TypeArguments="x:String" Name="dept_Name" />
                                        </Sequence.Variables>
                                        <sap:WorkflowViewStateService.ViewState>
                                          <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                            <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                          </scg:Dictionary>
                                        </sap:WorkflowViewStateService.ViewState>
                                        <Assign sap:VirtualizedContainerService.HintSize="470,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_22">
                                          <Assign.To>
                                            <OutArgument x:TypeArguments="x:String">[category]</OutArgument>
                                          </Assign.To>
                                          <Assign.Value>
                                            <InArgument x:TypeArguments="x:String">[CurrentRow("Category").ToString.Trim.ToLower]</InArgument>
                                          </Assign.Value>
                                        </Assign>
                                        <Switch x:TypeArguments="x:String" DisplayName="Switch" Expression="[category]" sap:VirtualizedContainerService.HintSize="470,2330.6666666666665" sap2010:WorkflowViewState.IdRef="Switch`1_1">
                                          <Switch.Default>
                                            <Sequence DisplayName="Default" sap:VirtualizedContainerService.HintSize="468,90.66666666666667" sap2010:WorkflowViewState.IdRef="Sequence_21">
                                              <sap:WorkflowViewStateService.ViewState>
                                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                  <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                </scg:Dictionary>
                                              </sap:WorkflowViewStateService.ViewState>
                                            </Sequence>
                                          </Switch.Default>
                                          <Sequence x:Key="chase delivery" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_11">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_23">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["Customer Service"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                          <Sequence x:Key="return" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_12">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_24">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["Customer Service"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                          <Sequence x:Key="collaboration" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_13">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_25">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["BD"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                          <Sequence x:Key="compliment" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_14">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_26">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["Customer Service"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                          <Sequence x:Key="quotation" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_15">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_27">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["Sales"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                          <Sequence x:Key="financial support" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_16">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_28">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["Finance"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                          <Sequence x:Key="application" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_17">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_29">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["Human Resources"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                          <Sequence x:Key="spam" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_18">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_30">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["Customer Service"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                          <Sequence x:Key="phising" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_19">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_31">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["Customer Service"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                          <Sequence x:Key="others" DisplayName="Body" sap:VirtualizedContainerService.HintSize="468,168" sap2010:WorkflowViewState.IdRef="Sequence_20">
                                            <sap:WorkflowViewStateService.ViewState>
                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                              </scg:Dictionary>
                                            </sap:WorkflowViewStateService.ViewState>
                                            <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_32">
                                              <Assign.To>
                                                <OutArgument x:TypeArguments="x:Object">[CurrentRow("Department")]</OutArgument>
                                              </Assign.To>
                                              <Assign.Value>
                                                <InArgument x:TypeArguments="x:Object">["Customer Service"]</InArgument>
                                              </Assign.Value>
                                            </Assign>
                                          </Sequence>
                                        </Switch>
                                        <ui:WriteRange StartingCell="{x:Null}" WorkbookPathResource="{x:Null}" DataTable="[dt_Email]" DisplayName="Write Range Workbook" sap:VirtualizedContainerService.HintSize="470,148" sap2010:WorkflowViewState.IdRef="WriteRange_5" SheetName="[nameSheet]" WorkbookPath="EmailAssignment\AssignedEmail.xlsx" />
                                        <Assign sap:VirtualizedContainerService.HintSize="470,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_20">
                                          <Assign.To>
                                            <OutArgument x:TypeArguments="x:String">[dept_Name]</OutArgument>
                                          </Assign.To>
                                          <Assign.Value>
                                            <InArgument x:TypeArguments="x:String">[CurrentRow("Department").ToString().Trim()]</InArgument>
                                          </Assign.Value>
                                        </Assign>
                                        <If Condition="[String.IsNullOrWhiteSpace(CurrentRow(&quot;Assign to&quot;).ToString)]" sap:VirtualizedContainerService.HintSize="470,1847.3333333333333" sap2010:WorkflowViewState.IdRef="If_2">
                                          <If.Then>
                                            <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="468,1489.3333333333333" sap2010:WorkflowViewState.IdRef="Sequence_22">
                                              <Sequence.Variables>
                                                <Variable x:TypeArguments="s:DateTime" Name="timeAssigned" />
                                                <Variable x:TypeArguments="x:String" Name="assign_TimeAssigned" />
                                                <Variable x:TypeArguments="s:DateTime" Name="deadlineDate" />
                                                <Variable x:TypeArguments="x:String" Name="bodymail" />
                                                <Variable x:TypeArguments="x:String" Name="dept_Email" />
                                              </Sequence.Variables>
                                              <sap:WorkflowViewStateService.ViewState>
                                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                  <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                </scg:Dictionary>
                                              </sap:WorkflowViewStateService.ViewState>
                                              <Assign sap:VirtualizedContainerService.HintSize="434,118.66666666666667" sap2010:WorkflowViewState.IdRef="Assign_21">
                                                <Assign.To>
                                                  <OutArgument x:TypeArguments="x:String">[dept_Email]</OutArgument>
                                                </Assign.To>
                                                <Assign.Value>
                                                  <InArgument x:TypeArguments="x:String" xml:space="preserve">[dt_Department.AsEnumerable().
    Where(Function(r) r("Department_Name").ToString.Trim.Equals(CurrentRow("Department").ToString.Trim)).
    Select(Function(r) r("Department_Email").ToString).
    FirstOrDefault()]</InArgument>
                                                </Assign.Value>
                                              </Assign>
                                              <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_33">
                                                <Assign.To>
                                                  <OutArgument x:TypeArguments="x:Object">[CurrentRow("Assign to")]</OutArgument>
                                                </Assign.To>
                                                <Assign.Value>
                                                  <InArgument x:TypeArguments="x:Object">[If(String.IsNullOrEmpty(dept_Email), "", dept_Email)]</InArgument>
                                                </Assign.Value>
                                              </Assign>
                                              <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_34">
                                                <Assign.To>
                                                  <OutArgument x:TypeArguments="x:Object">[CurrentRow("Time_Assigned")]</OutArgument>
                                                </Assign.To>
                                                <Assign.Value>
                                                  <InArgument x:TypeArguments="x:Object">[Now.ToString("yyyy-MM-dd HH:mm:ss")]</InArgument>
                                                </Assign.Value>
                                              </Assign>
                                              <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_35">
                                                <Assign.To>
                                                  <OutArgument x:TypeArguments="s:DateTime">[deadlineDate]</OutArgument>
                                                </Assign.To>
                                                <Assign.Value>
                                                  <InArgument x:TypeArguments="s:DateTime">[DateTime.Parse(CurrentRow("Time_Assigned").ToString).AddDays(2)]</InArgument>
                                                </Assign.Value>
                                              </Assign>
                                              <Assign sap:VirtualizedContainerService.HintSize="434,118.66666666666667" sap2010:WorkflowViewState.IdRef="Assign_36">
                                                <Assign.To>
                                                  <OutArgument x:TypeArguments="x:String">[bodymail]</OutArgument>
                                                </Assign.To>
                                                <Assign.Value>
                                                  <InArgument x:TypeArguments="x:String" xml:space="preserve">["&lt;html&gt;&lt;body&gt;" &amp;
"&lt;p&gt;Xin chào &lt;b&gt;" &amp; dept_Email &amp; "&lt;/b&gt;,&lt;/p&gt;" &amp;
"&lt;p&gt;Bạn được phân công xử lý nhiệm vụ có mã: &lt;b&gt;" &amp; CurrentRow("No").ToString &amp; "&lt;/b&gt;.&lt;/p&gt;" &amp;
"&lt;p&gt;Loại công việc: &lt;b&gt;" &amp; CurrentRow("Category").ToString &amp; "&lt;/b&gt;&lt;/p&gt;" &amp;
"&lt;p&gt;Phòng ban phụ trách: &lt;b&gt;" &amp; CurrentRow("Department").ToString &amp; "&lt;/b&gt;&lt;/p&gt;" &amp;
"&lt;p&gt;Thời gian phân công: &lt;b&gt;" &amp; CurrentRow("Time_Assigned").ToString &amp; "&lt;/b&gt;&lt;/p&gt;" &amp;
"&lt;p&gt;&lt;b style='color:red;'&gt;Deadline hoàn thành: " &amp; deadlineDate.ToString("dd/MM/yyyy") &amp; "&lt;/b&gt;&lt;/p&gt;" &amp;
"&lt;p&gt;Vui lòng thực hiện đúng thời hạn. Xin cảm ơn!&lt;/p&gt;" &amp;
"&lt;/body&gt;&lt;/html&gt;"]</InArgument>
                                                </Assign.Value>
                                              </Assign>
                                              <uga:SendEmailConnections ArgumentAttachmentPaths="{x:Null}" ArgumentAttachments="{x:Null}" AttachmentPaths="{x:Null}" Bcc="{x:Null}" Cc="{x:Null}" ConnectionAccountName="{x:Null}" ContinueOnError="{x:Null}" ReplyTo="{x:Null}" SingleAttachment="{x:Null}" TextBody="{x:Null}" AttachmentInputMode="UseExisting" AuthScopesInvalid="False" Body="[bodymail]" ConnectionId="80b20ac1-e255-4dd9-b899-f09d5698164a" DisplayName="Send Email" sap:VirtualizedContainerService.HintSize="434,497.3333333333333" sap2010:WorkflowViewState.IdRef="SendEmailConnections_1" Importance="Normal" InputType="HTML" SaveAsDraft="False" Subject="[&quot;Phân công nhiệm vụ #&quot; &amp; CurrentRow(&quot;No&quot;).ToString]" To="[New List(Of String) From {dept_Email}]" UseConnectionService="True">
                                                <uga:SendEmailConnections.Attachments>
                                                  <InArgument x:TypeArguments="scg:IEnumerable(upr:IResource)" />
                                                </uga:SendEmailConnections.Attachments>
                                                <uga:SendEmailConnections.AttachmentsBackup>
                                                  <usau1:BackupSlot x:TypeArguments="ugage:AttachmentInputMode" StoredValue="UseExisting">
                                                    <usau1:BackupSlot.BackupValues>
                                                      <scg:Dictionary x:TypeArguments="ugage:AttachmentInputMode, scg:List(x:Object)" />
                                                    </usau1:BackupSlot.BackupValues>
                                                  </usau1:BackupSlot>
                                                </uga:SendEmailConnections.AttachmentsBackup>
                                                <uga:SendEmailConnections.InputTypeBackup>
                                                  <usau1:BackupSlot x:TypeArguments="ugage:BodyInputType" StoredValue="HTML">
                                                    <usau1:BackupSlot.BackupValues>
                                                      <scg:Dictionary x:TypeArguments="ugage:BodyInputType, scg:List(x:Object)" />
                                                    </usau1:BackupSlot.BackupValues>
                                                  </usau1:BackupSlot>
                                                </uga:SendEmailConnections.InputTypeBackup>
                                              </uga:SendEmailConnections>
                                              <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_37">
                                                <Assign.To>
                                                  <OutArgument x:TypeArguments="x:Object">[CurrentRow("KeepTrack")]</OutArgument>
                                                </Assign.To>
                                                <Assign.Value>
                                                  <InArgument x:TypeArguments="x:Object">["Assigned"]</InArgument>
                                                </Assign.Value>
                                              </Assign>
                                              <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_38">
                                                <Assign.To>
                                                  <OutArgument x:TypeArguments="x:Object">[CurrentRow("Time_Assigned")]</OutArgument>
                                                </Assign.To>
                                                <Assign.Value>
                                                  <InArgument x:TypeArguments="x:Object">[Now.ToString("yyyy-MM-dd HH:mm:ss")]</InArgument>
                                                </Assign.Value>
                                              </Assign>
                                              <Assign sap:VirtualizedContainerService.HintSize="434,108" sap2010:WorkflowViewState.IdRef="Assign_39">
                                                <Assign.To>
                                                  <OutArgument x:TypeArguments="x:Object">[CurrentRow("Deadline")]</OutArgument>
                                                </Assign.To>
                                                <Assign.Value>
                                                  <InArgument x:TypeArguments="x:Object">[deadlineDate]</InArgument>
                                                </Assign.Value>
                                              </Assign>
                                            </Sequence>
                                          </If.Then>
                                          <If.Else>
                                            <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="468,227.33333333333334" sap2010:WorkflowViewState.IdRef="Sequence_23">
                                              <sap:WorkflowViewStateService.ViewState>
                                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                  <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                </scg:Dictionary>
                                              </sap:WorkflowViewStateService.ViewState>
                                              <ui:LogMessage DisplayName="Log Message" sap:VirtualizedContainerService.HintSize="434,167.33333333333334" sap2010:WorkflowViewState.IdRef="LogMessage_1" Message="[&quot;Skipped row &quot; &amp; dtData.Rows.IndexOf(CurrentRow).ToString() &amp; &quot; - Already assigned to &quot; &amp; If(CurrentRow.IsNull(&quot;Assign to&quot;), String.Empty, CurrentRow(&quot;Assign to&quot;).ToString())]" />
                                            </Sequence>
                                          </If.Else>
                                        </If>
                                      </Sequence>
                                    </ActivityAction>
                                  </ui:ForEachRow.Body>
                                  <ui:ForEachRow.CurrentIndex>
                                    <OutArgument x:TypeArguments="x:Int32">
                                      <VisualBasicReference x:TypeArguments="x:Int32" ExpressionText="index" sap2010:WorkflowViewState.IdRef="VisualBasicReference`1_1" />
                                    </OutArgument>
                                  </ui:ForEachRow.CurrentIndex>
                                  <sap:WorkflowViewStateService.ViewState>
                                    <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                      <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                      <x:Boolean x:Key="IsPinned">False</x:Boolean>
                                    </scg:Dictionary>
                                  </sap:WorkflowViewStateService.ViewState>
                                </ui:ForEachRow>
                              </Sequence>
                              <FlowStep.Next>
                                <FlowStep x:Name="__ReferenceID7" sap2010:WorkflowViewState.IdRef="FlowStep_10">
                                  <sap:WorkflowViewStateService.ViewState>
                                    <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                      <av:Point x:Key="ShapeLocation">525,1015</av:Point>
                                      <av:Size x:Key="ShapeSize">110,70</av:Size>
                                      <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,1085.1538461538462 580.0153846153846,1105</av:PointCollection>
                                    </scg:Dictionary>
                                  </sap:WorkflowViewStateService.ViewState>
                                  <ui:WriteRange StartingCell="{x:Null}" WorkbookPathResource="{x:Null}" DataTable="[dt_Email]" DisplayName="Write Range Workbook" sap:VirtualizedContainerService.HintSize="334.00000000000006,116" sap2010:WorkflowViewState.IdRef="WriteRange_6" SheetName="[nameSheet]" WorkbookPath="EmailAssignment\AssignedEmail.xlsx" />
                                  <FlowStep.Next>
                                    <FlowStep x:Name="__ReferenceID12" sap2010:WorkflowViewState.IdRef="FlowStep_11">
                                      <sap:WorkflowViewStateService.ViewState>
                                        <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                          <av:Point x:Key="ShapeLocation">525,1105</av:Point>
                                          <av:Size x:Key="ShapeSize">110,70</av:Size>
                                          <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,1175.1538461538462 580.0153846153846,1205</av:PointCollection>
                                        </scg:Dictionary>
                                      </sap:WorkflowViewStateService.ViewState>
                                      <Assign DisplayName="Assign sheetName old day" sap:VirtualizedContainerService.HintSize="433.99999999999994,85.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_50">
                                        <Assign.To>
                                          <OutArgument x:TypeArguments="x:String">[sheetName]</OutArgument>
                                        </Assign.To>
                                        <Assign.Value>
                                          <InArgument x:TypeArguments="x:String">[Now.AddDays(-1).ToString("dd-MM-yyyy")]</InArgument>
                                        </Assign.Value>
                                      </Assign>
                                      <FlowStep.Next>
                                        <FlowStep x:Name="__ReferenceID9" sap2010:WorkflowViewState.IdRef="FlowStep_12">
                                          <sap:WorkflowViewStateService.ViewState>
                                            <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                              <av:Point x:Key="ShapeLocation">525,1205</av:Point>
                                              <av:Size x:Key="ShapeSize">110,70</av:Size>
                                              <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,1275.1538461538462 580.0153846153846,1315</av:PointCollection>
                                            </scg:Dictionary>
                                          </sap:WorkflowViewStateService.ViewState>
                                          <ui:ReadRange Range="{x:Null}" WorkbookPathResource="{x:Null}" AddHeaders="True" DataTable="[dt_Email]" DisplayName="Read Range Workbook" sap:VirtualizedContainerService.HintSize="334,88" sap2010:WorkflowViewState.IdRef="ReadRange_7" SheetName="[sheetName]" WorkbookPath="EmailAssignment\AssignedEmail.xlsx" />
                                          <FlowStep.Next>
                                            <FlowStep x:Name="__ReferenceID8" sap2010:WorkflowViewState.IdRef="FlowStep_13">
                                              <sap:WorkflowViewStateService.ViewState>
                                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                  <av:Point x:Key="ShapeLocation">525,1315</av:Point>
                                                  <av:Size x:Key="ShapeSize">110,70</av:Size>
                                                  <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,1385.1538461538462 580.0153846153846,1415</av:PointCollection>
                                                </scg:Dictionary>
                                              </sap:WorkflowViewStateService.ViewState>
                                              <ui:ReadRange Range="{x:Null}" WorkbookPathResource="{x:Null}" AddHeaders="True" DataTable="[dt_Department]" DisplayName="Read Department Infor" sap:VirtualizedContainerService.HintSize="334,88" sap2010:WorkflowViewState.IdRef="ReadRange_6" SheetName="sheet1" WorkbookPath="Department\Department_List.xlsx" />
                                              <FlowStep.Next>
                                                <FlowStep x:Name="__ReferenceID10" sap2010:WorkflowViewState.IdRef="FlowStep_4">
                                                  <sap:WorkflowViewStateService.ViewState>
                                                    <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                      <av:Point x:Key="ShapeLocation">525,1415</av:Point>
                                                      <av:Size x:Key="ShapeSize">110,70</av:Size>
                                                      <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,1485.1538461538462 580.0153846153846,1515</av:PointCollection>
                                                    </scg:Dictionary>
                                                  </sap:WorkflowViewStateService.ViewState>
                                                  <Sequence DisplayName="Deadline Monitoring" sap:VirtualizedContainerService.HintSize="648,4232.666666666667" sap2010:WorkflowViewState.IdRef="Sequence_25">
                                                    <sap:WorkflowViewStateService.ViewState>
                                                      <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                      </scg:Dictionary>
                                                    </sap:WorkflowViewStateService.ViewState>
                                                    <ui:ForEachRow ColumnNames="{x:Null}" CurrentIndex="{x:Null}" DataTable="[dt_Email]" DisplayName="For Each Row in Data Table" sap:VirtualizedContainerService.HintSize="614,4172.666666666667" sap2010:WorkflowViewState.IdRef="ForEachRow_3">
                                                      <ui:ForEachRow.Body>
                                                        <ActivityAction x:TypeArguments="sd:DataRow">
                                                          <ActivityAction.Argument>
                                                            <DelegateInArgument x:TypeArguments="sd:DataRow" Name="CurrentRow" />
                                                          </ActivityAction.Argument>
                                                          <Sequence DisplayName="Body" sap:VirtualizedContainerService.HintSize="612,3998" sap2010:WorkflowViewState.IdRef="Sequence_34">
                                                            <Sequence.Variables>
                                                              <Variable x:TypeArguments="s:DateTime" Name="now" />
                                                              <Variable x:TypeArguments="x:String" Name="status" />
                                                              <Variable x:TypeArguments="x:Double" Name="timeDiff" />
                                                              <Variable x:TypeArguments="s:DateTime" Name="assignTime" />
                                                            </Sequence.Variables>
                                                            <sap:WorkflowViewStateService.ViewState>
                                                              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                              </scg:Dictionary>
                                                            </sap:WorkflowViewStateService.ViewState>
                                                            <Assign sap:VirtualizedContainerService.HintSize="578,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_40">
                                                              <Assign.To>
                                                                <OutArgument x:TypeArguments="s:DateTime">[now]</OutArgument>
                                                              </Assign.To>
                                                              <Assign.Value>
                                                                <InArgument x:TypeArguments="s:DateTime">[DateTime.Now]</InArgument>
                                                              </Assign.Value>
                                                            </Assign>
                                                            <Assign sap:VirtualizedContainerService.HintSize="578,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_41">
                                                              <Assign.To>
                                                                <OutArgument x:TypeArguments="x:String">[status]</OutArgument>
                                                              </Assign.To>
                                                              <Assign.Value>
                                                                <InArgument x:TypeArguments="x:String">[CurrentRow("Keeptrack").ToString]</InArgument>
                                                              </Assign.Value>
                                                            </Assign>
                                                            <Assign sap:VirtualizedContainerService.HintSize="578,118.66666666666667" sap2010:WorkflowViewState.IdRef="Assign_42">
                                                              <Assign.To>
                                                                <OutArgument x:TypeArguments="s:DateTime">[assignTime]</OutArgument>
                                                              </Assign.To>
                                                              <Assign.Value>
                                                                <InArgument x:TypeArguments="s:DateTime" xml:space="preserve">[DateTime.ParseExact(
    CurrentRow("Time_Assigned").ToString.Trim,
    {"yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm", "MM/dd/yyyy HH:mm:ss", "MM/dd/yyyy HH:mm"},
    System.Globalization.CultureInfo.InvariantCulture,
    System.Globalization.DateTimeStyles.None
)]</InArgument>
                                                              </Assign.Value>
                                                            </Assign>
                                                            <ui:InvokeCode ContinueOnError="{x:Null}" Code="Dim parsedDate As DateTime&#xA;Dim rawValue As Object = CurrentRow(&quot;Time_Assigned&quot;)&#xA;&#xA;If TypeOf rawValue Is DateTime Then&#xA;    parsedDate = CType(rawValue, DateTime)&#xA;&#xA;ElseIf TypeOf rawValue Is String Then&#xA;    Dim textValue As String = rawValue.ToString.Trim&#xA;    Dim formats As String() = {&#xA;        &quot;MM/dd/yyyy HH:mm&quot;,&#xA;        &quot;MM/dd/yyyy HH:mm:ss&quot;,&#xA;        &quot;yyyy-MM-dd HH:mm&quot;,&#xA;        &quot;yyyy-MM-dd HH:mm:ss&quot;&#xA;    }&#xA;&#xA;    Dim success As Boolean = False&#xA;    For Each f As String In formats&#xA;        If DateTime.TryParseExact(textValue, f, System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None, parsedDate) Then&#xA;            success = True&#xA;            Exit For&#xA;        End If&#xA;    Next&#xA;&#xA;    If Not success Then&#xA;        ' fallback nếu chuỗi không khớp format nào&#xA;        DateTime.TryParse(textValue, parsedDate)&#xA;    End If&#xA;Else&#xA;    ' fallback cho kiểu dữ liệu lạ (DBNull, etc.)&#xA;    parsedDate = DateTime.MinValue&#xA;End If&#xA;&#xA;assignTime = parsedDate&#xA;" DisplayName="Invoke Code" sap:VirtualizedContainerService.HintSize="578,197.33333333333334" sap2010:WorkflowViewState.IdRef="InvokeCode_1">
                                                              <ui:InvokeCode.Arguments>
                                                                <OutArgument x:TypeArguments="s:DateTime" x:Key="assignTime" />
                                                                <InArgument x:TypeArguments="sd:DataRow" x:Key="CurrentRow">[CurrentRow]</InArgument>
                                                              </ui:InvokeCode.Arguments>
                                                            </ui:InvokeCode>
                                                            <Assign sap:VirtualizedContainerService.HintSize="578,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_43">
                                                              <Assign.To>
                                                                <OutArgument x:TypeArguments="x:Double">[timeDiff]</OutArgument>
                                                              </Assign.To>
                                                              <Assign.Value>
                                                                <InArgument x:TypeArguments="x:Double">[(now - assignTime).TotalHours]</InArgument>
                                                              </Assign.Value>
                                                            </Assign>
                                                            <If Condition="[status = &quot;Done&quot;]" sap:VirtualizedContainerService.HintSize="578,3270" sap2010:WorkflowViewState.IdRef="If_3">
                                                              <If.Then>
                                                                <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="576,227.33333333333334" sap2010:WorkflowViewState.IdRef="Sequence_26">
                                                                  <sap:WorkflowViewStateService.ViewState>
                                                                    <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                                      <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                                    </scg:Dictionary>
                                                                  </sap:WorkflowViewStateService.ViewState>
                                                                  <ui:LogMessage DisplayName="Log Message" sap:VirtualizedContainerService.HintSize="542,167.33333333333334" sap2010:WorkflowViewState.IdRef="LogMessage_2" Message="[“Hoàn tất - Dừng theo dõi”]" />
                                                                </Sequence>
                                                              </If.Then>
                                                              <If.Else>
                                                                <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="576,2912" sap2010:WorkflowViewState.IdRef="Sequence_33">
                                                                  <sap:WorkflowViewStateService.ViewState>
                                                                    <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                                      <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                                    </scg:Dictionary>
                                                                  </sap:WorkflowViewStateService.ViewState>
                                                                  <If Condition="[status = &quot;Assigned&quot;]" sap:VirtualizedContainerService.HintSize="542,2852" sap2010:WorkflowViewState.IdRef="If_4">
                                                                    <If.Then>
                                                                      <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="540,2630.6666666666665" sap2010:WorkflowViewState.IdRef="Sequence_31">
                                                                        <sap:WorkflowViewStateService.ViewState>
                                                                          <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                                            <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                                          </scg:Dictionary>
                                                                        </sap:WorkflowViewStateService.ViewState>
                                                                        <If Condition="[timeDiff &gt;= 24 And timeDiff &lt; 48]" sap:VirtualizedContainerService.HintSize="506,2570.6666666666665" sap2010:WorkflowViewState.IdRef="If_5">
                                                                          <If.Then>
                                                                            <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="504,1079.3333333333333" sap2010:WorkflowViewState.IdRef="Sequence_27">
                                                                              <Sequence.Variables>
                                                                                <Variable x:TypeArguments="x:String" Name="dept_Email" />
                                                                                <Variable x:TypeArguments="x:String" Name="body_remind_email" />
                                                                              </Sequence.Variables>
                                                                              <sap:WorkflowViewStateService.ViewState>
                                                                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                                                  <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                                                </scg:Dictionary>
                                                                              </sap:WorkflowViewStateService.ViewState>
                                                                              <Assign sap:VirtualizedContainerService.HintSize="470,118.66666666666667" sap2010:WorkflowViewState.IdRef="Assign_44">
                                                                                <Assign.To>
                                                                                  <OutArgument x:TypeArguments="x:String">[dept_Email]</OutArgument>
                                                                                </Assign.To>
                                                                                <Assign.Value>
                                                                                  <InArgument x:TypeArguments="x:String" xml:space="preserve">[dt_Department.AsEnumerable().
    Where(Function(r) r("Department_Name").ToString.Trim.Equals(CurrentRow("Department").ToString.Trim)).
    Select(Function(r) r("Department_Email").ToString).
    FirstOrDefault()]</InArgument>
                                                                                </Assign.Value>
                                                                              </Assign>
                                                                              <Assign sap:VirtualizedContainerService.HintSize="470,118.66666666666667" sap2010:WorkflowViewState.IdRef="Assign_45">
                                                                                <Assign.To>
                                                                                  <OutArgument x:TypeArguments="x:String">[body_remind_email]</OutArgument>
                                                                                </Assign.To>
                                                                                <Assign.Value>
                                                                                  <InArgument x:TypeArguments="x:String" xml:space="preserve">[String.Format(
"&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset='utf-8' /&gt;
    &lt;style&gt;
      body {{ font-family: Arial, Helvetica, sans-serif; font-size:14px; color:#333; }}
      .card {{ border:1px solid #e0e0e0; border-radius:8px; padding:16px; max-width:640px; }}
      .header {{ background:#0b6efd; color:white; padding:12px 16px; border-radius:6px 6px 0 0; }}
      .detail-table {{ width:100%; border-collapse:collapse; margin-top:12px; }}
      .detail-table td {{ padding:8px; border-bottom:1px solid #f0f0f0; vertical-align:top; }}
      .btn {{ display:inline-block; padding:10px 14px; margin-top:12px; text-decoration:none; border-radius:6px; background:#198754; color:white; }}
      .muted {{ color:#666; font-size:12px; }}
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class='card'&gt;
      &lt;div class='header'&gt;&lt;strong&gt;Nhắc nhở xử lý email trễ hạn — Lần 1&lt;/strong&gt;&lt;/div&gt;
      &lt;p&gt;Xin chào &lt;strong&gt;{1}&lt;/strong&gt;,&lt;/p&gt;
      &lt;p&gt;Hệ thống ghi nhận email &lt;strong&gt;#{0}&lt;/strong&gt; (khách: &lt;strong&gt;{2}&lt;/strong&gt;) chưa được xử lý và đã vượt quá thời hạn SLA.&lt;/p&gt;

      &lt;table class='detail-table'&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Tiêu đề&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{3}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Thời gian nhận&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{4}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Thời gian phân công&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{5}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Thời hạn (Deadline)&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{6}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Số lần nhắc hiện tại&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{7}&lt;/td&gt;&lt;/tr&gt;
      &lt;/table&gt;

      &lt;p&gt;Vui lòng xử lý và phản hồi khách hàng trong &lt;strong&gt;24 giờ&lt;/strong&gt; kể từ thông báo này để tránh bị báo cáo lên quản lý.&lt;/p&gt;

      &lt;p&gt;
        &lt;a href='mailto:{1}?subject=Hoàn%20thành%20email%20#{0}' class='btn'&gt;Đã xử lý — Gửi phản hồi&lt;/a&gt;
      &lt;/p&gt;

      &lt;p class='muted'&gt;Nếu bạn đã xử lý trước khi nhận được email này, vui lòng cập nhật trạng thái trên hệ thống.&lt;/p&gt;
      &lt;p class='muted'&gt;Trân trọng,&lt;br/&gt;Automated SLA Monitor&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;",
    currentRow("No").ToString,               ' {0}
    currentRow("Assign to").ToString,        ' {1}
    currentRow("Sender_Name").ToString,      ' {2}
    currentRow("Subject").ToString,          ' {3}
    currentRow("Received_Time").ToString,    ' {4}
    currentRow("Time_Assigned").ToString,    ' {5}
    currentRow("Deadline").ToString,         ' {6}
    currentRow("ReminderCount").ToString     ' {7}
)]</InArgument>
                                                                                </Assign.Value>
                                                                              </Assign>
                                                                              <Assign sap:VirtualizedContainerService.HintSize="470,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_46">
                                                                                <Assign.To>
                                                                                  <OutArgument x:TypeArguments="x:Object">[CurrentRow("ReminderCount")]</OutArgument>
                                                                                </Assign.To>
                                                                                <Assign.Value>
                                                                                  <InArgument x:TypeArguments="x:Object">["1"]</InArgument>
                                                                                </Assign.Value>
                                                                              </Assign>
                                                                              <uga:SendEmailConnections ArgumentAttachmentPaths="{x:Null}" ArgumentAttachments="{x:Null}" AttachmentPaths="{x:Null}" Bcc="{x:Null}" Cc="{x:Null}" ConnectionAccountName="{x:Null}" ContinueOnError="{x:Null}" ReplyTo="{x:Null}" SingleAttachment="{x:Null}" TextBody="{x:Null}" AttachmentInputMode="UseExisting" AuthScopesInvalid="False" Body="[body_remind_email]" ConnectionId="80b20ac1-e255-4dd9-b899-f09d5698164a" DisplayName="Send Email" sap:VirtualizedContainerService.HintSize="470,497.3333333333333" sap2010:WorkflowViewState.IdRef="SendEmailConnections_2" Importance="Normal" InputType="HTML" SaveAsDraft="False" Subject="[Nhắc nhở] Xử lý email trễ hạn - Lần 1" To="[New List(Of String) From {dept_Email}]" UseConnectionService="True">
                                                                                <uga:SendEmailConnections.Attachments>
                                                                                  <InArgument x:TypeArguments="scg:IEnumerable(upr:IResource)" />
                                                                                </uga:SendEmailConnections.Attachments>
                                                                                <uga:SendEmailConnections.AttachmentsBackup>
                                                                                  <usau1:BackupSlot x:TypeArguments="ugage:AttachmentInputMode" StoredValue="UseExisting">
                                                                                    <usau1:BackupSlot.BackupValues>
                                                                                      <scg:Dictionary x:TypeArguments="ugage:AttachmentInputMode, scg:List(x:Object)" />
                                                                                    </usau1:BackupSlot.BackupValues>
                                                                                  </usau1:BackupSlot>
                                                                                </uga:SendEmailConnections.AttachmentsBackup>
                                                                                <uga:SendEmailConnections.InputTypeBackup>
                                                                                  <usau1:BackupSlot x:TypeArguments="ugage:BodyInputType" StoredValue="HTML">
                                                                                    <usau1:BackupSlot.BackupValues>
                                                                                      <scg:List x:TypeArguments="x:Object" x:Key="HTML" Capacity="1">
                                                                                        <x:Null />
                                                                                      </scg:List>
                                                                                      <scg:List x:TypeArguments="x:Object" x:Key="TEXT" Capacity="1">
                                                                                        <x:Null />
                                                                                      </scg:List>
                                                                                    </usau1:BackupSlot.BackupValues>
                                                                                  </usau1:BackupSlot>
                                                                                </uga:SendEmailConnections.InputTypeBackup>
                                                                              </uga:SendEmailConnections>
                                                                              <ui:LogMessage DisplayName="Log Message" sap:VirtualizedContainerService.HintSize="470,167.33333333333334" sap2010:WorkflowViewState.IdRef="LogMessage_3" Message="[&quot;Đã gửi email lần 1&quot;]" />
                                                                            </Sequence>
                                                                          </If.Then>
                                                                          <If.Else>
                                                                            <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="504,1360.6666666666667" sap2010:WorkflowViewState.IdRef="Sequence_30">
                                                                              <sap:WorkflowViewStateService.ViewState>
                                                                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                                                  <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                                                </scg:Dictionary>
                                                                              </sap:WorkflowViewStateService.ViewState>
                                                                              <If Condition="[timeDiff &gt;= 48 AndAlso CurrentRow(&quot;ReminderCount&quot;).ToString = &quot;1&quot;]" sap:VirtualizedContainerService.HintSize="470,1300.6666666666667" sap2010:WorkflowViewState.IdRef="If_6">
                                                                                <If.Then>
                                                                                  <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="468,1079.3333333333333" sap2010:WorkflowViewState.IdRef="Sequence_28">
                                                                                    <Sequence.Variables>
                                                                                      <Variable x:TypeArguments="x:String" Name="managerEmail" />
                                                                                      <Variable x:TypeArguments="x:String" Name="body_report_manager" />
                                                                                    </Sequence.Variables>
                                                                                    <sap:WorkflowViewStateService.ViewState>
                                                                                      <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                                                        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                                                      </scg:Dictionary>
                                                                                    </sap:WorkflowViewStateService.ViewState>
                                                                                    <Assign sap:VirtualizedContainerService.HintSize="434,118.66666666666667" sap2010:WorkflowViewState.IdRef="Assign_47">
                                                                                      <Assign.To>
                                                                                        <OutArgument x:TypeArguments="x:String">[managerEmail]</OutArgument>
                                                                                      </Assign.To>
                                                                                      <Assign.Value>
                                                                                        <InArgument x:TypeArguments="x:String" xml:space="preserve">[dt_Department.AsEnumerable().
    Where(Function(r) r("Department_Name").ToString.Trim.ToLower.Equals("manager")).
    Select(Function(r) r("Department_Email").ToString).
    FirstOrDefault()]</InArgument>
                                                                                      </Assign.Value>
                                                                                    </Assign>
                                                                                    <Assign sap:VirtualizedContainerService.HintSize="434,118.66666666666667" sap2010:WorkflowViewState.IdRef="Assign_48">
                                                                                      <Assign.To>
                                                                                        <OutArgument x:TypeArguments="x:String">[body_report_manager]</OutArgument>
                                                                                      </Assign.To>
                                                                                      <Assign.Value>
                                                                                        <InArgument x:TypeArguments="x:String" xml:space="preserve">[String.Format(
"&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset='utf-8' /&gt;
    &lt;style&gt;
      body {{ font-family: Arial, Helvetica, sans-serif; font-size:14px; color:#222; }}
      .card {{ border:1px solid #e6e6e6; border-radius:8px; padding:16px; max-width:700px; }}
      .header {{ background:#dc3545; color:white; padding:12px 16px; border-radius:6px 6px 0 0; }}
      .detail-table {{ width:100%; border-collapse:collapse; margin-top:12px; }}
      .detail-table td {{ padding:8px; border-bottom:1px solid #f7f7f7; vertical-align:top; }}
      .muted {{ color:#666; font-size:13px; }}
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class='card'&gt;
      &lt;div class='header'&gt;&lt;strong&gt;[Báo cáo] Email trễ hạn đã 2 lần nhắc&lt;/strong&gt;&lt;/div&gt;

      &lt;p&gt;Xin chào Quản lý,&lt;/p&gt;
      &lt;p&gt;Hệ thống ghi nhận email &lt;strong&gt;#{0}&lt;/strong&gt; vẫn chưa được xử lý sau &lt;strong&gt;2 lần nhắc&lt;/strong&gt;. Chi tiết:&lt;/p&gt;

      &lt;table class='detail-table'&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Email ID&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{0}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Người xử lý&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{1}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Khách hàng&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{2}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Tiêu đề&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{3}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Thời gian phân công&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{4}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Deadline&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{5}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Số lần nhắc&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{6}&lt;/td&gt;&lt;/tr&gt;
      &lt;/table&gt;

      &lt;p&gt;Yêu cầu Quản lý xem xét và chỉ đạo xử lý. Nếu cần, hệ thống có thể phân lại cho nhân viên khác theo yêu cầu.&lt;/p&gt;

      &lt;p class='muted'&gt;Được tạo tự động bởi SLA Monitor.&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;",
    currentRow("No").ToString,               ' {0}
    currentRow("Assign to").ToString,        ' {1}
    currentRow("Sender_Name").ToString,      ' {2}
    currentRow("Subject").ToString,          ' {3}
    currentRow("Time_Assigned").ToString,    ' {4}
    currentRow("Deadline").ToString,         ' {5}
    currentRow("ReminderCount").ToString     ' {6}
)]</InArgument>
                                                                                      </Assign.Value>
                                                                                    </Assign>
                                                                                    <uga:SendEmailConnections ArgumentAttachmentPaths="{x:Null}" ArgumentAttachments="{x:Null}" AttachmentPaths="{x:Null}" Bcc="{x:Null}" Cc="{x:Null}" ConnectionAccountName="{x:Null}" ContinueOnError="{x:Null}" ReplyTo="{x:Null}" SingleAttachment="{x:Null}" TextBody="{x:Null}" AttachmentInputMode="UseExisting" AuthScopesInvalid="False" Body="[body_report_manager]" ConnectionId="80b20ac1-e255-4dd9-b899-f09d5698164a" DisplayName="Send Email" sap:VirtualizedContainerService.HintSize="434,497.3333333333333" sap2010:WorkflowViewState.IdRef="SendEmailConnections_3" Importance="Normal" InputType="HTML" SaveAsDraft="False" Subject="[Báo cáo] Email trễ hạn sau 2 lần nhắc" To="[New List(Of String) From {managerEmail}]" UseConnectionService="True">
                                                                                      <uga:SendEmailConnections.Attachments>
                                                                                        <InArgument x:TypeArguments="scg:IEnumerable(upr:IResource)" />
                                                                                      </uga:SendEmailConnections.Attachments>
                                                                                      <uga:SendEmailConnections.AttachmentsBackup>
                                                                                        <usau1:BackupSlot x:TypeArguments="ugage:AttachmentInputMode" StoredValue="UseExisting">
                                                                                          <usau1:BackupSlot.BackupValues>
                                                                                            <scg:Dictionary x:TypeArguments="ugage:AttachmentInputMode, scg:List(x:Object)" />
                                                                                          </usau1:BackupSlot.BackupValues>
                                                                                        </usau1:BackupSlot>
                                                                                      </uga:SendEmailConnections.AttachmentsBackup>
                                                                                      <uga:SendEmailConnections.InputTypeBackup>
                                                                                        <usau1:BackupSlot x:TypeArguments="ugage:BodyInputType" StoredValue="HTML">
                                                                                          <usau1:BackupSlot.BackupValues>
                                                                                            <scg:Dictionary x:TypeArguments="ugage:BodyInputType, scg:List(x:Object)" />
                                                                                          </usau1:BackupSlot.BackupValues>
                                                                                        </usau1:BackupSlot>
                                                                                      </uga:SendEmailConnections.InputTypeBackup>
                                                                                    </uga:SendEmailConnections>
                                                                                    <Assign sap:VirtualizedContainerService.HintSize="434,117.33333333333333" sap2010:WorkflowViewState.IdRef="Assign_49">
                                                                                      <Assign.To>
                                                                                        <OutArgument x:TypeArguments="x:Object">[CurrentRow("Keeptrack")]</OutArgument>
                                                                                      </Assign.To>
                                                                                      <Assign.Value>
                                                                                        <InArgument x:TypeArguments="x:Object">["Overdue - Reported"]</InArgument>
                                                                                      </Assign.Value>
                                                                                    </Assign>
                                                                                    <ui:LogMessage DisplayName="Log Message" sap:VirtualizedContainerService.HintSize="434,167.33333333333334" sap2010:WorkflowViewState.IdRef="LogMessage_4" Message="[“Đã báo cáo lên quản lý”]" />
                                                                                  </Sequence>
                                                                                </If.Then>
                                                                                <If.Else>
                                                                                  <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="468,90.66666666666667" sap2010:WorkflowViewState.IdRef="Sequence_29">
                                                                                    <sap:WorkflowViewStateService.ViewState>
                                                                                      <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                                                        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                                                      </scg:Dictionary>
                                                                                    </sap:WorkflowViewStateService.ViewState>
                                                                                  </Sequence>
                                                                                </If.Else>
                                                                              </If>
                                                                            </Sequence>
                                                                          </If.Else>
                                                                        </If>
                                                                      </Sequence>
                                                                    </If.Then>
                                                                    <If.Else>
                                                                      <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="540,90.66666666666667" sap2010:WorkflowViewState.IdRef="Sequence_32">
                                                                        <sap:WorkflowViewStateService.ViewState>
                                                                          <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                                            <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                                                          </scg:Dictionary>
                                                                        </sap:WorkflowViewStateService.ViewState>
                                                                      </Sequence>
                                                                    </If.Else>
                                                                  </If>
                                                                </Sequence>
                                                              </If.Else>
                                                            </If>
                                                          </Sequence>
                                                        </ActivityAction>
                                                      </ui:ForEachRow.Body>
                                                    </ui:ForEachRow>
                                                  </Sequence>
                                                  <FlowStep.Next>
                                                    <FlowStep x:Name="__ReferenceID11" sap2010:WorkflowViewState.IdRef="FlowStep_14">
                                                      <sap:WorkflowViewStateService.ViewState>
                                                        <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                                          <av:Point x:Key="ShapeLocation">525,1515</av:Point>
                                                          <av:Size x:Key="ShapeSize">110,70</av:Size>
                                                        </scg:Dictionary>
                                                      </sap:WorkflowViewStateService.ViewState>
                                                      <ui:WriteRange StartingCell="{x:Null}" WorkbookPathResource="{x:Null}" DataTable="[dt_Email]" DisplayName="Write Range Workbook" sap:VirtualizedContainerService.HintSize="334.00000000000006,116" sap2010:WorkflowViewState.IdRef="WriteRange_8" SheetName="[sheetName]" WorkbookPath="EmailAssignment\AssignedEmail.xlsx" />
                                                    </FlowStep>
                                                  </FlowStep.Next>
                                                </FlowStep>
                                              </FlowStep.Next>
                                            </FlowStep>
                                          </FlowStep.Next>
                                        </FlowStep>
                                      </FlowStep.Next>
                                    </FlowStep>
                                  </FlowStep.Next>
                                </FlowStep>
                              </FlowStep.Next>
                            </FlowStep>
                          </FlowStep.Next>
                        </FlowStep>
                      </FlowStep.Next>
                    </FlowStep>
                  </FlowStep.Next>
                </FlowStep>
              </FlowStep.Next>
            </FlowStep>
          </FlowStep.Next>
        </FlowStep>
      </FlowStep.Next>
    </FlowStep>
    <x:Reference>__ReferenceID0</x:Reference>
    <x:Reference>__ReferenceID1</x:Reference>
    <FlowStep x:Name="__ReferenceID13" sap2010:WorkflowViewState.IdRef="FlowStep_1">
      <sap:WorkflowViewStateService.ViewState>
        <scg:Dictionary x:TypeArguments="x:String, x:Object">
          <av:Point x:Key="ShapeLocation">525,165</av:Point>
          <av:Size x:Key="ShapeSize">110,70</av:Size>
          <av:PointCollection x:Key="ConnectorLocation">580.0153846153846,235.15384615384613 580.0153846153846,265</av:PointCollection>
        </scg:Dictionary>
      </sap:WorkflowViewStateService.ViewState>
      <Assign DisplayName="Assign nameSheet" sap:VirtualizedContainerService.HintSize="110,70" sap2010:WorkflowViewState.IdRef="Assign_19">
        <Assign.To>
          <OutArgument x:TypeArguments="x:String">[nameSheet]</OutArgument>
        </Assign.To>
        <Assign.Value>
          <InArgument x:TypeArguments="x:String">[Now.ToString("dd-MM-yyyy")]</InArgument>
        </Assign.Value>
      </Assign>
      <FlowStep.Next>
        <x:Reference>__ReferenceID2</x:Reference>
      </FlowStep.Next>
    </FlowStep>
    <x:Reference>__ReferenceID3</x:Reference>
    <x:Reference>__ReferenceID4</x:Reference>
    <x:Reference>__ReferenceID5</x:Reference>
    <x:Reference>__ReferenceID6</x:Reference>
    <x:Reference>__ReferenceID7</x:Reference>
    <x:Reference>__ReferenceID8</x:Reference>
    <x:Reference>__ReferenceID9</x:Reference>
    <x:Reference>__ReferenceID10</x:Reference>
    <x:Reference>__ReferenceID11</x:Reference>
    <x:Reference>__ReferenceID12</x:Reference>
  </Flowchart>
</Activity>