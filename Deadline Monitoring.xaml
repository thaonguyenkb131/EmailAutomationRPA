<Activity mc:Ignorable="sap sap2010" x:Class="Deadline_Monitoring" VisualBasic.Settings="{x:Null}" sap2010:WorkflowViewState.IdRef="Deadline_Monitoring_1" xmlns="http://schemas.microsoft.com/netfx/2009/xaml/activities" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:s="clr-namespace:System;assembly=System.Private.CoreLib" xmlns:sap="http://schemas.microsoft.com/netfx/2009/xaml/activities/presentation" xmlns:sap2010="http://schemas.microsoft.com/netfx/2010/xaml/activities/presentation" xmlns:scg="clr-namespace:System.Collections.Generic;assembly=System.Private.CoreLib" xmlns:sco="clr-namespace:System.Collections.ObjectModel;assembly=System.Private.CoreLib" xmlns:sd="clr-namespace:System.Data;assembly=System.Data.Common" xmlns:uga="clr-namespace:UiPath.GSuite.Activities;assembly=UiPath.GSuite.Activities" xmlns:ugage="clr-namespace:UiPath.GSuite.Activities.Gmail.Enums;assembly=UiPath.GSuite.Activities" xmlns:ui="http://schemas.uipath.com/workflow/activities" xmlns:upr="clr-namespace:UiPath.Platform.ResourceHandling;assembly=UiPath.Platform" xmlns:usau="clr-namespace:UiPath.Shared.Activities.Utils;assembly=UiPath.GSuite.Activities" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <TextExpression.NamespacesForImplementation>
    <sco:Collection x:TypeArguments="x:String">
      <x:String>System.Activities</x:String>
      <x:String>System.Activities.Statements</x:String>
      <x:String>System.Activities.Expressions</x:String>
      <x:String>System.Activities.Validation</x:String>
      <x:String>System.Activities.XamlIntegration</x:String>
      <x:String>Microsoft.VisualBasic</x:String>
      <x:String>Microsoft.VisualBasic.Activities</x:String>
      <x:String>System</x:String>
      <x:String>System.Collections</x:String>
      <x:String>System.Collections.Generic</x:String>
      <x:String>System.Collections.ObjectModel</x:String>
      <x:String>System.Data</x:String>
      <x:String>System.Diagnostics</x:String>
      <x:String>System.Drawing</x:String>
      <x:String>System.IO</x:String>
      <x:String>System.Linq</x:String>
      <x:String>System.Net.Mail</x:String>
      <x:String>System.Xml</x:String>
      <x:String>System.Xml.Linq</x:String>
      <x:String>UiPath.Core</x:String>
      <x:String>UiPath.Core.Activities</x:String>
      <x:String>System.Windows.Markup</x:String>
      <x:String>GlobalVariablesNamespace</x:String>
      <x:String>GlobalConstantsNamespace</x:String>
      <x:String>System.ComponentModel</x:String>
      <x:String>System.Runtime.Serialization</x:String>
      <x:String>System.Xml.Serialization</x:String>
      <x:String>UiPath.Excel</x:String>
      <x:String>UiPath.Platform.ResourceHandling</x:String>
      <x:String>UiPath.Excel.Activities</x:String>
      <x:String>System.Linq.Expressions</x:String>
      <x:String>System.Reflection</x:String>
      <x:String>UiPath.DataTableUtilities</x:String>
      <x:String>System.Numerics</x:String>
      <x:String>UiPath.GSuite.Activities.Gmail.Enums</x:String>
      <x:String>UiPath.Shared.Activities.Utils</x:String>
      <x:String>UiPath.GSuite.Activities</x:String>
      <x:String>UiPath.Shared.Activities</x:String>
      <x:String>UiPath.Shared.Activities.ConnectionService.Contracts</x:String>
      <x:String>System.Globalization</x:String>
    </sco:Collection>
  </TextExpression.NamespacesForImplementation>
  <TextExpression.ReferencesForImplementation>
    <sco:Collection x:TypeArguments="AssemblyReference">
      <AssemblyReference>Microsoft.VisualBasic</AssemblyReference>
      <AssemblyReference>mscorlib</AssemblyReference>
      <AssemblyReference>System</AssemblyReference>
      <AssemblyReference>System.Activities</AssemblyReference>
      <AssemblyReference>System.ComponentModel.TypeConverter</AssemblyReference>
      <AssemblyReference>System.Core</AssemblyReference>
      <AssemblyReference>System.Data</AssemblyReference>
      <AssemblyReference>System.Data.Common</AssemblyReference>
      <AssemblyReference>System.Data.DataSetExtensions</AssemblyReference>
      <AssemblyReference>System.Drawing</AssemblyReference>
      <AssemblyReference>System.Drawing.Common</AssemblyReference>
      <AssemblyReference>System.Drawing.Primitives</AssemblyReference>
      <AssemblyReference>System.Linq</AssemblyReference>
      <AssemblyReference>System.Net.Mail</AssemblyReference>
      <AssemblyReference>System.ObjectModel</AssemblyReference>
      <AssemblyReference>System.Private.CoreLib</AssemblyReference>
      <AssemblyReference>System.Xaml</AssemblyReference>
      <AssemblyReference>System.Xml</AssemblyReference>
      <AssemblyReference>System.Xml.Linq</AssemblyReference>
      <AssemblyReference>UiPath.System.Activities</AssemblyReference>
      <AssemblyReference>UiPath.UiAutomation.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Studio.Constants</AssemblyReference>
      <AssemblyReference>System.ComponentModel.EventBasedAsync</AssemblyReference>
      <AssemblyReference>PresentationFramework</AssemblyReference>
      <AssemblyReference>WindowsBase</AssemblyReference>
      <AssemblyReference>System.ComponentModel</AssemblyReference>
      <AssemblyReference>System.ComponentModel.Primitives</AssemblyReference>
      <AssemblyReference>System.Private.ServiceModel</AssemblyReference>
      <AssemblyReference>System.Private.DataContractSerialization</AssemblyReference>
      <AssemblyReference>System.Runtime.Serialization.Formatters</AssemblyReference>
      <AssemblyReference>System.Runtime.Serialization.Primitives</AssemblyReference>
      <AssemblyReference>System.Private.Xml</AssemblyReference>
      <AssemblyReference>UiPath.Excel.Activities.Design</AssemblyReference>
      <AssemblyReference>UiPath.Excel</AssemblyReference>
      <AssemblyReference>UiPath.Excel.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Platform</AssemblyReference>
      <AssemblyReference>System.Memory.Data</AssemblyReference>
      <AssemblyReference>System.Console</AssemblyReference>
      <AssemblyReference>System.Security.Permissions</AssemblyReference>
      <AssemblyReference>System.Configuration.ConfigurationManager</AssemblyReference>
      <AssemblyReference>System.Memory</AssemblyReference>
      <AssemblyReference>System.Private.Uri</AssemblyReference>
      <AssemblyReference>NPOI.Core</AssemblyReference>
      <AssemblyReference>System.Linq.Async</AssemblyReference>
      <AssemblyReference>System.Collections</AssemblyReference>
      <AssemblyReference>System.Collections.NonGeneric</AssemblyReference>
      <AssemblyReference>System.Linq.Expressions</AssemblyReference>
      <AssemblyReference>System.Reflection.DispatchProxy</AssemblyReference>
      <AssemblyReference>System.Reflection.TypeExtensions</AssemblyReference>
      <AssemblyReference>System.Reflection.Metadata</AssemblyReference>
      <AssemblyReference>System.Data.SqlClient</AssemblyReference>
      <AssemblyReference>System.Runtime.Numerics</AssemblyReference>
      <AssemblyReference>UiPath.GSuite.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Mail.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Testing.Activities</AssemblyReference>
      <AssemblyReference>UiPath.DocumentUnderstanding.ML.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Web.Activities</AssemblyReference>
      <AssemblyReference>UiPath.UIAutomationCore</AssemblyReference>
      <AssemblyReference>UiPath.OCR.Activities</AssemblyReference>
      <AssemblyReference>UiPath.IntelligentOCR.Activities</AssemblyReference>
      <AssemblyReference>InternalLabs.OpenAI.DallE.Activities</AssemblyReference>
      <AssemblyReference>UiPath.Workflow</AssemblyReference>
      <AssemblyReference>System.Linq.Async.Queryable</AssemblyReference>
      <AssemblyReference>System.Collections.Immutable</AssemblyReference>
      <AssemblyReference>System.Linq.Parallel</AssemblyReference>
      <AssemblyReference>System.Linq.Queryable</AssemblyReference>
      <AssemblyReference>System.CodeDom</AssemblyReference>
      <AssemblyReference>Microsoft.VisualBasic.Forms</AssemblyReference>
      <AssemblyReference>Microsoft.VisualBasic.Core</AssemblyReference>
    </sco:Collection>
  </TextExpression.ReferencesForImplementation>
  <Sequence DisplayName="Deadline_Monitoring" sap:VirtualizedContainerService.HintSize="1152.6461538461538,4644.184615384615" sap2010:WorkflowViewState.IdRef="Sequence_1">
    <Sequence.Variables>
      <Variable x:TypeArguments="x:String" Name="status" />
      <Variable x:TypeArguments="sd:DataTable" Name="dtAssigned" />
      <Variable x:TypeArguments="sd:DataTable" Name="dt_Department" />
      <Variable x:TypeArguments="x:String" Name="sheetName" />
    </Sequence.Variables>
    <sap:WorkflowViewStateService.ViewState>
      <scg:Dictionary x:TypeArguments="x:String, x:Object">
        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
      </scg:Dictionary>
    </sap:WorkflowViewStateService.ViewState>
    <Assign sap:VirtualizedContainerService.HintSize="615.1384615384615,114.46153846153845" sap2010:WorkflowViewState.IdRef="Assign_12">
      <Assign.To>
        <OutArgument x:TypeArguments="x:String">[sheetName]</OutArgument>
      </Assign.To>
      <Assign.Value>
        <InArgument x:TypeArguments="x:String">[Now.AddDays(-1).ToString("dd-MM-yyyy")]</InArgument>
      </Assign.Value>
    </Assign>
    <ui:ReadRange Range="{x:Null}" WorkbookPathResource="{x:Null}" AddHeaders="True" DataTable="[dtAssigned]" DisplayName="Read Range Workbook" sap:VirtualizedContainerService.HintSize="615.1384615384615,119.63076923076922" sap2010:WorkflowViewState.IdRef="ReadRange_1" SheetName="[sheetName]" WorkbookPath="EmailAssignment\AssignedEmail.xlsx" />
    <ui:ReadRange Range="{x:Null}" WorkbookPathResource="{x:Null}" AddHeaders="True" DataTable="[dt_Department]" DisplayName="Read Range Workbook" sap:VirtualizedContainerService.HintSize="615.1384615384615,119.63076923076922" sap2010:WorkflowViewState.IdRef="ReadRange_2" SheetName="sheet1" WorkbookPath="Department\Department_List.xlsx" />
    <ui:ForEachRow ColumnNames="{x:Null}" CurrentIndex="{x:Null}" DataTable="[dtAssigned]" DisplayName="For Each Row in Data Table" sap:VirtualizedContainerService.HintSize="615.1384615384615,4128.738461538462" sap2010:WorkflowViewState.IdRef="ForEachRow_1">
      <ui:ForEachRow.Body>
        <ActivityAction x:TypeArguments="sd:DataRow">
          <ActivityAction.Argument>
            <DelegateInArgument x:TypeArguments="sd:DataRow" Name="CurrentRow" />
          </ActivityAction.Argument>
          <Sequence DisplayName="Body" sap:VirtualizedContainerService.HintSize="612.9230769230769,3947.076923076923" sap2010:WorkflowViewState.IdRef="Sequence_2">
            <Sequence.Variables>
              <Variable x:TypeArguments="s:DateTime" Name="now" />
              <Variable x:TypeArguments="x:String" Name="status" />
              <Variable x:TypeArguments="x:Double" Name="timeDiff" />
              <Variable x:TypeArguments="s:DateTime" Name="assignTime" />
            </Sequence.Variables>
            <sap:WorkflowViewStateService.ViewState>
              <scg:Dictionary x:TypeArguments="x:String, x:Object">
                <x:Boolean x:Key="IsExpanded">True</x:Boolean>
              </scg:Dictionary>
            </sap:WorkflowViewStateService.ViewState>
            <Assign sap:VirtualizedContainerService.HintSize="578.9538461538461,114.46153846153845" sap2010:WorkflowViewState.IdRef="Assign_1">
              <Assign.To>
                <OutArgument x:TypeArguments="s:DateTime">[now]</OutArgument>
              </Assign.To>
              <Assign.Value>
                <InArgument x:TypeArguments="s:DateTime">[DateTime.Now]</InArgument>
              </Assign.Value>
            </Assign>
            <Assign sap:VirtualizedContainerService.HintSize="578.9538461538461,114.46153846153845" sap2010:WorkflowViewState.IdRef="Assign_2">
              <Assign.To>
                <OutArgument x:TypeArguments="x:String">[status]</OutArgument>
              </Assign.To>
              <Assign.Value>
                <InArgument x:TypeArguments="x:String">[CurrentRow("Keeptrack").ToString]</InArgument>
              </Assign.Value>
            </Assign>
            <Assign sap:VirtualizedContainerService.HintSize="578.9538461538461,115.93846153846154" sap2010:WorkflowViewState.IdRef="Assign_16">
              <Assign.To>
                <OutArgument x:TypeArguments="s:DateTime">[assignTime]</OutArgument>
              </Assign.To>
              <Assign.Value>
                <InArgument x:TypeArguments="s:DateTime" xml:space="preserve">[DateTime.ParseExact(
    CurrentRow("Time_Assigned").ToString.Trim,
    {"yyyy-MM-dd HH:mm:ss", "yyyy-MM-dd HH:mm", "MM/dd/yyyy HH:mm:ss", "MM/dd/yyyy HH:mm"},
    System.Globalization.CultureInfo.InvariantCulture,
    System.Globalization.DateTimeStyles.None
)]</InArgument>
              </Assign.Value>
            </Assign>
            <ui:InvokeCode ContinueOnError="{x:Null}" Code="Dim parsedDate As DateTime&#xA;Dim rawValue As Object = CurrentRow(&quot;Time_Assigned&quot;)&#xA;&#xA;If TypeOf rawValue Is DateTime Then&#xA;    parsedDate = CType(rawValue, DateTime)&#xA;&#xA;ElseIf TypeOf rawValue Is String Then&#xA;    Dim textValue As String = rawValue.ToString.Trim&#xA;    Dim formats As String() = {&#xA;        &quot;MM/dd/yyyy HH:mm&quot;,&#xA;        &quot;MM/dd/yyyy HH:mm:ss&quot;,&#xA;        &quot;yyyy-MM-dd HH:mm&quot;,&#xA;        &quot;yyyy-MM-dd HH:mm:ss&quot;&#xA;    }&#xA;&#xA;    Dim success As Boolean = False&#xA;    For Each f As String In formats&#xA;        If DateTime.TryParseExact(textValue, f, System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTimeStyles.None, parsedDate) Then&#xA;            success = True&#xA;            Exit For&#xA;        End If&#xA;    Next&#xA;&#xA;    If Not success Then&#xA;        ' fallback nếu chuỗi không khớp format nào&#xA;        DateTime.TryParse(textValue, parsedDate)&#xA;    End If&#xA;Else&#xA;    ' fallback cho kiểu dữ liệu lạ (DBNull, etc.)&#xA;    parsedDate = DateTime.MinValue&#xA;End If&#xA;&#xA;assignTime = parsedDate&#xA;" DisplayName="Invoke Code" sap:VirtualizedContainerService.HintSize="578.9538461538461,196.43076923076922" sap2010:WorkflowViewState.IdRef="InvokeCode_1">
              <ui:InvokeCode.Arguments>
                <OutArgument x:TypeArguments="s:DateTime" x:Key="assignTime" />
                <InArgument x:TypeArguments="sd:DataRow" x:Key="CurrentRow">[CurrentRow]</InArgument>
              </ui:InvokeCode.Arguments>
            </ui:InvokeCode>
            <Assign sap:VirtualizedContainerService.HintSize="578.9538461538461,114.46153846153845" sap2010:WorkflowViewState.IdRef="Assign_3">
              <Assign.To>
                <OutArgument x:TypeArguments="x:Double">[timeDiff]</OutArgument>
              </Assign.To>
              <Assign.Value>
                <InArgument x:TypeArguments="x:Double">[(now - assignTime).TotalHours]</InArgument>
              </Assign.Value>
            </Assign>
            <If Condition="[status = &quot;Done&quot;]" sap:VirtualizedContainerService.HintSize="578.9538461538461,3231.507692307692" sap2010:WorkflowViewState.IdRef="If_4">
              <If.Then>
                <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="576.7384615384615,225.23076923076923" sap2010:WorkflowViewState.IdRef="Sequence_9">
                  <sap:WorkflowViewStateService.ViewState>
                    <scg:Dictionary x:TypeArguments="x:String, x:Object">
                      <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                    </scg:Dictionary>
                  </sap:WorkflowViewStateService.ViewState>
                  <ui:LogMessage DisplayName="Log Message" sap:VirtualizedContainerService.HintSize="542.7692307692307,165.4153846153846" sap2010:WorkflowViewState.IdRef="LogMessage_10" Message="[“Hoàn tất - Dừng theo dõi”]" />
                </Sequence>
              </If.Then>
              <If.Else>
                <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="576.7384615384615,2876.3076923076924" sap2010:WorkflowViewState.IdRef="Sequence_10">
                  <sap:WorkflowViewStateService.ViewState>
                    <scg:Dictionary x:TypeArguments="x:String, x:Object">
                      <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                    </scg:Dictionary>
                  </sap:WorkflowViewStateService.ViewState>
                  <If Condition="[status = &quot;Assigned&quot;]" sap:VirtualizedContainerService.HintSize="542.7692307692307,2816.4923076923073" sap2010:WorkflowViewState.IdRef="If_8">
                    <If.Then>
                      <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="540.5538461538462,2596.430769230769" sap2010:WorkflowViewState.IdRef="Sequence_15">
                        <sap:WorkflowViewStateService.ViewState>
                          <scg:Dictionary x:TypeArguments="x:String, x:Object">
                            <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                          </scg:Dictionary>
                        </sap:WorkflowViewStateService.ViewState>
                        <If Condition="[timeDiff &gt;= 24 And timeDiff &lt; 48]" sap:VirtualizedContainerService.HintSize="506.58461538461535,2536.6153846153843" sap2010:WorkflowViewState.IdRef="If_9">
                          <If.Then>
                            <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="504.36923076923074,1063.3846153846152" sap2010:WorkflowViewState.IdRef="Sequence_11">
                              <Sequence.Variables>
                                <Variable x:TypeArguments="x:String" Name="dept_Email" />
                                <Variable x:TypeArguments="x:String" Name="body_remind_email" />
                              </Sequence.Variables>
                              <sap:WorkflowViewStateService.ViewState>
                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                  <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                </scg:Dictionary>
                              </sap:WorkflowViewStateService.ViewState>
                              <Assign sap:VirtualizedContainerService.HintSize="470.4,115.93846153846154" sap2010:WorkflowViewState.IdRef="Assign_18">
                                <Assign.To>
                                  <OutArgument x:TypeArguments="x:String">[dept_Email]</OutArgument>
                                </Assign.To>
                                <Assign.Value>
                                  <InArgument x:TypeArguments="x:String" xml:space="preserve">[dt_Department.AsEnumerable().
    Where(Function(r) r("Department_Name").ToString.Trim.Equals(CurrentRow("Department").ToString.Trim)).
    Select(Function(r) r("Department_Email").ToString).
    FirstOrDefault()]</InArgument>
                                </Assign.Value>
                              </Assign>
                              <Assign sap:VirtualizedContainerService.HintSize="470.4,115.93846153846154" sap2010:WorkflowViewState.IdRef="Assign_19">
                                <Assign.To>
                                  <OutArgument x:TypeArguments="x:String">[body_remind_email]</OutArgument>
                                </Assign.To>
                                <Assign.Value>
                                  <InArgument x:TypeArguments="x:String" xml:space="preserve">[String.Format(
"&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset='utf-8' /&gt;
    &lt;style&gt;
      body {{ font-family: Arial, Helvetica, sans-serif; font-size:14px; color:#333; }}
      .card {{ border:1px solid #e0e0e0; border-radius:8px; padding:16px; max-width:640px; }}
      .header {{ background:#0b6efd; color:white; padding:12px 16px; border-radius:6px 6px 0 0; }}
      .detail-table {{ width:100%; border-collapse:collapse; margin-top:12px; }}
      .detail-table td {{ padding:8px; border-bottom:1px solid #f0f0f0; vertical-align:top; }}
      .btn {{ display:inline-block; padding:10px 14px; margin-top:12px; text-decoration:none; border-radius:6px; background:#198754; color:white; }}
      .muted {{ color:#666; font-size:12px; }}
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class='card'&gt;
      &lt;div class='header'&gt;&lt;strong&gt;Nhắc nhở xử lý email trễ hạn — Lần 1&lt;/strong&gt;&lt;/div&gt;
      &lt;p&gt;Xin chào &lt;strong&gt;{1}&lt;/strong&gt;,&lt;/p&gt;
      &lt;p&gt;Hệ thống ghi nhận email &lt;strong&gt;#{0}&lt;/strong&gt; (khách: &lt;strong&gt;{2}&lt;/strong&gt;) chưa được xử lý và đã vượt quá thời hạn SLA.&lt;/p&gt;

      &lt;table class='detail-table'&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Tiêu đề&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{3}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Thời gian nhận&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{4}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Thời gian phân công&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{5}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Thời hạn (Deadline)&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{6}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Số lần nhắc hiện tại&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{7}&lt;/td&gt;&lt;/tr&gt;
      &lt;/table&gt;

      &lt;p&gt;Vui lòng xử lý và phản hồi khách hàng trong &lt;strong&gt;24 giờ&lt;/strong&gt; kể từ thông báo này để tránh bị báo cáo lên quản lý.&lt;/p&gt;

      &lt;p&gt;
        &lt;a href='mailto:{1}?subject=Hoàn%20thành%20email%20#{0}' class='btn'&gt;Đã xử lý — Gửi phản hồi&lt;/a&gt;
      &lt;/p&gt;

      &lt;p class='muted'&gt;Nếu bạn đã xử lý trước khi nhận được email này, vui lòng cập nhật trạng thái trên hệ thống.&lt;/p&gt;
      &lt;p class='muted'&gt;Trân trọng,&lt;br/&gt;Automated SLA Monitor&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;",
    currentRow("No").ToString,               ' {0}
    currentRow("Assign to").ToString,        ' {1}
    currentRow("Sender_Name").ToString,      ' {2}
    currentRow("Subject").ToString,          ' {3}
    currentRow("Received_Time").ToString,    ' {4}
    currentRow("Time_Assigned").ToString,    ' {5}
    currentRow("Deadline").ToString,         ' {6}
    currentRow("ReminderCount").ToString     ' {7}
)]</InArgument>
                                </Assign.Value>
                              </Assign>
                              <Assign sap:VirtualizedContainerService.HintSize="470.4,114.46153846153845" sap2010:WorkflowViewState.IdRef="Assign_25">
                                <Assign.To>
                                  <OutArgument x:TypeArguments="x:Object">[CurrentRow("ReminderCount")]</OutArgument>
                                </Assign.To>
                                <Assign.Value>
                                  <InArgument x:TypeArguments="x:Object">["1"]</InArgument>
                                </Assign.Value>
                              </Assign>
                              <uga:SendEmailConnections ArgumentAttachmentPaths="{x:Null}" ArgumentAttachments="{x:Null}" AttachmentPaths="{x:Null}" Bcc="{x:Null}" Cc="{x:Null}" ConnectionAccountName="{x:Null}" ContinueOnError="{x:Null}" ReplyTo="{x:Null}" SingleAttachment="{x:Null}" TextBody="{x:Null}" AttachmentInputMode="UseExisting" AuthScopesInvalid="False" Body="[body_remind_email]" ConnectionId="80b20ac1-e255-4dd9-b899-f09d5698164a" DisplayName="Send Email" sap:VirtualizedContainerService.HintSize="470.4,491.8153846153846" sap2010:WorkflowViewState.IdRef="SendEmailConnections_4" Importance="Normal" InputType="HTML" SaveAsDraft="False" Subject="[Nhắc nhở] Xử lý email trễ hạn - Lần 1" To="[New List(Of String) From {dept_Email}]" UseConnectionService="True">
                                <uga:SendEmailConnections.Attachments>
                                  <InArgument x:TypeArguments="scg:IEnumerable(upr:IResource)" />
                                </uga:SendEmailConnections.Attachments>
                                <uga:SendEmailConnections.AttachmentsBackup>
                                  <usau:BackupSlot x:TypeArguments="ugage:AttachmentInputMode" StoredValue="UseExisting">
                                    <usau:BackupSlot.BackupValues>
                                      <scg:Dictionary x:TypeArguments="ugage:AttachmentInputMode, scg:List(x:Object)" />
                                    </usau:BackupSlot.BackupValues>
                                  </usau:BackupSlot>
                                </uga:SendEmailConnections.AttachmentsBackup>
                                <uga:SendEmailConnections.InputTypeBackup>
                                  <usau:BackupSlot x:TypeArguments="ugage:BodyInputType" StoredValue="HTML">
                                    <usau:BackupSlot.BackupValues>
                                      <scg:List x:TypeArguments="x:Object" x:Key="HTML" Capacity="1">
                                        <x:Null />
                                      </scg:List>
                                      <scg:List x:TypeArguments="x:Object" x:Key="TEXT" Capacity="1">
                                        <x:Null />
                                      </scg:List>
                                    </usau:BackupSlot.BackupValues>
                                  </usau:BackupSlot>
                                </uga:SendEmailConnections.InputTypeBackup>
                              </uga:SendEmailConnections>
                              <ui:LogMessage DisplayName="Log Message" sap:VirtualizedContainerService.HintSize="470.4,165.4153846153846" sap2010:WorkflowViewState.IdRef="LogMessage_12" Message="[&quot;Đã gửi email lần 1&quot;]" />
                            </Sequence>
                          </If.Then>
                          <If.Else>
                            <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="504.36923076923074,1343.2615384615383" sap2010:WorkflowViewState.IdRef="Sequence_14">
                              <sap:WorkflowViewStateService.ViewState>
                                <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                  <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                </scg:Dictionary>
                              </sap:WorkflowViewStateService.ViewState>
                              <If Condition="[timeDiff &gt;= 48 AndAlso CurrentRow(&quot;ReminderCount&quot;).ToString = &quot;1&quot;]" sap:VirtualizedContainerService.HintSize="470.4,1283.4461538461537" sap2010:WorkflowViewState.IdRef="If_10">
                                <If.Then>
                                  <Sequence DisplayName="Then" sap:VirtualizedContainerService.HintSize="468.18461538461537,1063.3846153846152" sap2010:WorkflowViewState.IdRef="Sequence_12">
                                    <Sequence.Variables>
                                      <Variable x:TypeArguments="x:String" Name="managerEmail" />
                                      <Variable x:TypeArguments="x:String" Name="body_report_manager" />
                                    </Sequence.Variables>
                                    <sap:WorkflowViewStateService.ViewState>
                                      <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                      </scg:Dictionary>
                                    </sap:WorkflowViewStateService.ViewState>
                                    <Assign sap:VirtualizedContainerService.HintSize="434.2153846153846,115.93846153846154" sap2010:WorkflowViewState.IdRef="Assign_21">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[managerEmail]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String" xml:space="preserve">[dt_Department.AsEnumerable().
    Where(Function(r) r("Department_Name").ToString.Trim.ToLower.Equals("manager")).
    Select(Function(r) r("Department_Email").ToString).
    FirstOrDefault()]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <Assign sap:VirtualizedContainerService.HintSize="434.2153846153846,115.93846153846154" sap2010:WorkflowViewState.IdRef="Assign_22">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:String">[body_report_manager]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:String" xml:space="preserve">[String.Format(
"&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset='utf-8' /&gt;
    &lt;style&gt;
      body {{ font-family: Arial, Helvetica, sans-serif; font-size:14px; color:#222; }}
      .card {{ border:1px solid #e6e6e6; border-radius:8px; padding:16px; max-width:700px; }}
      .header {{ background:#dc3545; color:white; padding:12px 16px; border-radius:6px 6px 0 0; }}
      .detail-table {{ width:100%; border-collapse:collapse; margin-top:12px; }}
      .detail-table td {{ padding:8px; border-bottom:1px solid #f7f7f7; vertical-align:top; }}
      .muted {{ color:#666; font-size:13px; }}
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class='card'&gt;
      &lt;div class='header'&gt;&lt;strong&gt;[Báo cáo] Email trễ hạn đã 2 lần nhắc&lt;/strong&gt;&lt;/div&gt;

      &lt;p&gt;Xin chào Quản lý,&lt;/p&gt;
      &lt;p&gt;Hệ thống ghi nhận email &lt;strong&gt;#{0}&lt;/strong&gt; vẫn chưa được xử lý sau &lt;strong&gt;2 lần nhắc&lt;/strong&gt;. Chi tiết:&lt;/p&gt;

      &lt;table class='detail-table'&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Email ID&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{0}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Người xử lý&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{1}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Khách hàng&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{2}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Tiêu đề&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{3}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Thời gian phân công&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{4}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Deadline&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{5}&lt;/td&gt;&lt;/tr&gt;
        &lt;tr&gt;&lt;td&gt;&lt;strong&gt;Số lần nhắc&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;{6}&lt;/td&gt;&lt;/tr&gt;
      &lt;/table&gt;

      &lt;p&gt;Yêu cầu Quản lý xem xét và chỉ đạo xử lý. Nếu cần, hệ thống có thể phân lại cho nhân viên khác theo yêu cầu.&lt;/p&gt;

      &lt;p class='muted'&gt;Được tạo tự động bởi SLA Monitor.&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;",
    currentRow("No").ToString,               ' {0}
    currentRow("Assign to").ToString,        ' {1}
    currentRow("Sender_Name").ToString,      ' {2}
    currentRow("Subject").ToString,          ' {3}
    currentRow("Time_Assigned").ToString,    ' {4}
    currentRow("Deadline").ToString,         ' {5}
    currentRow("ReminderCount").ToString     ' {6}
)]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <uga:SendEmailConnections ArgumentAttachmentPaths="{x:Null}" ArgumentAttachments="{x:Null}" AttachmentPaths="{x:Null}" Bcc="{x:Null}" Cc="{x:Null}" ConnectionAccountName="{x:Null}" ContinueOnError="{x:Null}" ReplyTo="{x:Null}" SingleAttachment="{x:Null}" TextBody="{x:Null}" AttachmentInputMode="UseExisting" AuthScopesInvalid="False" Body="[body_report_manager]" ConnectionId="80b20ac1-e255-4dd9-b899-f09d5698164a" DisplayName="Send Email" sap:VirtualizedContainerService.HintSize="434.2153846153846,491.8153846153846" sap2010:WorkflowViewState.IdRef="SendEmailConnections_5" Importance="Normal" InputType="HTML" SaveAsDraft="False" Subject="[Báo cáo] Email trễ hạn sau 2 lần nhắc" To="[New List(Of String) From {managerEmail}]" UseConnectionService="True">
                                      <uga:SendEmailConnections.Attachments>
                                        <InArgument x:TypeArguments="scg:IEnumerable(upr:IResource)" />
                                      </uga:SendEmailConnections.Attachments>
                                      <uga:SendEmailConnections.AttachmentsBackup>
                                        <usau:BackupSlot x:TypeArguments="ugage:AttachmentInputMode" StoredValue="UseExisting">
                                          <usau:BackupSlot.BackupValues>
                                            <scg:Dictionary x:TypeArguments="ugage:AttachmentInputMode, scg:List(x:Object)" />
                                          </usau:BackupSlot.BackupValues>
                                        </usau:BackupSlot>
                                      </uga:SendEmailConnections.AttachmentsBackup>
                                      <uga:SendEmailConnections.InputTypeBackup>
                                        <usau:BackupSlot x:TypeArguments="ugage:BodyInputType" StoredValue="HTML">
                                          <usau:BackupSlot.BackupValues>
                                            <scg:Dictionary x:TypeArguments="ugage:BodyInputType, scg:List(x:Object)" />
                                          </usau:BackupSlot.BackupValues>
                                        </usau:BackupSlot>
                                      </uga:SendEmailConnections.InputTypeBackup>
                                    </uga:SendEmailConnections>
                                    <Assign sap:VirtualizedContainerService.HintSize="434.2153846153846,114.46153846153845" sap2010:WorkflowViewState.IdRef="Assign_24">
                                      <Assign.To>
                                        <OutArgument x:TypeArguments="x:Object">[CurrentRow("Keeptrack")]</OutArgument>
                                      </Assign.To>
                                      <Assign.Value>
                                        <InArgument x:TypeArguments="x:Object">["Overdue - Reported"]</InArgument>
                                      </Assign.Value>
                                    </Assign>
                                    <ui:LogMessage DisplayName="Log Message" sap:VirtualizedContainerService.HintSize="434.2153846153846,165.4153846153846" sap2010:WorkflowViewState.IdRef="LogMessage_13" Message="[“Đã báo cáo lên quản lý”]" />
                                  </Sequence>
                                </If.Then>
                                <If.Else>
                                  <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="468.18461538461537,90.09230769230768" sap2010:WorkflowViewState.IdRef="Sequence_13">
                                    <sap:WorkflowViewStateService.ViewState>
                                      <scg:Dictionary x:TypeArguments="x:String, x:Object">
                                        <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                                      </scg:Dictionary>
                                    </sap:WorkflowViewStateService.ViewState>
                                  </Sequence>
                                </If.Else>
                              </If>
                            </Sequence>
                          </If.Else>
                        </If>
                      </Sequence>
                    </If.Then>
                    <If.Else>
                      <Sequence DisplayName="Else" sap:VirtualizedContainerService.HintSize="540.5538461538462,90.09230769230768" sap2010:WorkflowViewState.IdRef="Sequence_16">
                        <sap:WorkflowViewStateService.ViewState>
                          <scg:Dictionary x:TypeArguments="x:String, x:Object">
                            <x:Boolean x:Key="IsExpanded">True</x:Boolean>
                          </scg:Dictionary>
                        </sap:WorkflowViewStateService.ViewState>
                      </Sequence>
                    </If.Else>
                  </If>
                </Sequence>
              </If.Else>
            </If>
          </Sequence>
        </ActivityAction>
      </ui:ForEachRow.Body>
    </ui:ForEachRow>
    <ui:WriteRange StartingCell="{x:Null}" WorkbookPathResource="{x:Null}" DataTable="[dtAssigned]" DisplayName="Write Range Workbook" sap:VirtualizedContainerService.HintSize="615.1384615384615,138.83076923076922" sap2010:WorkflowViewState.IdRef="WriteRange_1" SheetName="[sheetName]" WorkbookPath="EmailAssignment\AssignedEmail.xlsx" />
  </Sequence>
</Activity>